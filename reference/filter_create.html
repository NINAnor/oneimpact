<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="This function creates matrices of weights following different
functions to be used in neighborhood analyses for rasters. In the context of
cumulative impact analysis, they represent the Zone of Influence (ZoI) of each
infrastructure point/pixel, to be used to calculate the cumulative ZoI.
It is possible to export these matrices as text files, for use with external
software such as the r.mfilter module within GRASS GIS."><title>Create filters or kernel matrices for raster neighborhood analyses — filter_create • oneimpact</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Create filters or kernel matrices for raster neighborhood analyses — filter_create"><meta property="og:description" content="This function creates matrices of weights following different
functions to be used in neighborhood analyses for rasters. In the context of
cumulative impact analysis, they represent the Zone of Influence (ZoI) of each
infrastructure point/pixel, to be used to calculate the cumulative ZoI.
It is possible to export these matrices as text files, for use with external
software such as the r.mfilter module within GRASS GIS."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">oneimpact</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/oneimpact.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/computing_zoi.html">Computing zones of influence for different types of variable</a>
  </div>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/NINAnor/oneimpact/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Create filters or kernel matrices for raster neighborhood analyses</h1>
      <small class="dont-index">Source: <a href="https://github.com/NINAnor/oneimpact/blob/HEAD/R/filter_create.R" class="external-link"><code>R/filter_create.R</code></a></small>
      <div class="d-none name"><code>filter_create.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function creates matrices of weights following different
functions to be used in neighborhood analyses for rasters. In the context of
cumulative impact analysis, they represent the Zone of Influence (ZoI) of each
infrastructure point/pixel, to be used to calculate the cumulative ZoI.
It is possible to export these matrices as text files, for use with external
software such as the <code>r.mfilter</code> module within GRASS GIS.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">filter_create</span><span class="op">(</span></span>
<span>  r <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  radius <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"exp_decay"</span>, <span class="st">"bartlett"</span>, <span class="st">"circle"</span>, <span class="st">"threshold_decay"</span>, <span class="st">"gaussian_decay"</span>,</span>
<span>    <span class="st">"Gauss"</span>, <span class="st">"rectangle"</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>  zoi_limit <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  half_life <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  zoi_hl_ratio <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  sigma <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  min_intensity <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>  max_dist <span class="op">=</span> <span class="fl">5000</span>,</span>
<span>  normalize <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  divisor <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  round_vals <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  save_txt <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  save_format <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"GRASS_rmfilter"</span>, <span class="st">"raw"</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>  save_folder <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  save_file <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  parallel <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>r</dt>
<dd><p><code>[numeric,SpatRaster,RasterLayer]</code> <br> Either a numeric value
corresponding to the resolution (pixel size) that each pixel in the filter matrix
should correspond to; or a raster object (<code>SpatRaster</code> from the <a href="https://rdrr.io/pkg/terra/man/terra-package.html" class="external-link">terra</a>
package or <code>RasterLayer</code>, <code>RasterBrick</code>, or <code>RasterStack</code> from the
<code>raster</code> package) from which such resolution can be extracted.</p></dd>


<dt>radius</dt>
<dd><p><code>[numeric(1)=NULL]</code> <br> Zone of Influence (ZoI) radius,
in map units (preferentially meters).
The ZoI radius is the distance, scale, or buffer size around a
feature up to which we consider there is
an effect or influence of an infrastructure or variable. In <code>filter_create</code>,
the interpretation of the
radius differ depending on the shape of the zoi (parameter <code>type</code>):</p><ul><li><p>For the circle neighborhood (<code>type = "circle"</code> or <code>type = "threshold"</code>
or <code>type = "step"</code>), the <code>radius</code> corresponds to the radius
(or threshold) of the circle, beyond which the filter is zero.</p></li>
<li><p>For the rectangular neighborhood (<code>type = "rectangle"</code> or <code>type = "box"</code>),
the <code>radius</code> corresponds to half the size of the square size, or
<code>square size = 2*radius</code>. For a rectangular filter with different size
of the sides, use <code><a href="https://rdrr.io/pkg/terra/man/focal.html" class="external-link">terra::focal()</a></code> (but
please note the interpretation of the parameters is different).</p></li>
<li><p>For the Bartlett neighborhood (<code>type = "bartlett"</code> or
<code>type = "linear_decay"</code> or <code>type = "tent_decay"</code>),
the <code>radius</code> corresponds to the distance beyond which the filter is zero.</p></li>
<li><p>For the exponential decay neighborhood (<code>type = "exp_decay"</code>) and the
Gaussian decay neighborhood (<code>type = "Gauss"</code> or <code>type = "gaussian_decay"</code>),
the <code>radius</code> corresponds to the distance where the exponential decay
function goes below a given limit distance defined by
<code>zoi_limit</code>. See <code><a href="zoi_functions.html">zoi_functions()</a></code> for details.</p></li>
<li><p>If <code>radius = NULL</code>, the exponential or gaussian decay matrices are
defined based on other parameters -- see below. This option will raise an
error for the other types of filters.</p></li>
</ul></dd>


<dt>type</dt>
<dd><p><code>[character(1)="exp_decay"]{"exp_decay", "bartlett", "circle", "threshold_decay", "gaussian_decay", "Gauss", "rectangle"}</code> <br>
Shape of the Zone of Influence of weight matrix. It can be any of:</p><ul><li><p><code>"circle"</code>, <code>"threshold"</code>, <code>"threshold_decay"</code>, <code>"step"</code> or <code>"step_decay"</code>
for a threshold decay ZoI;</p></li>
<li><p><code>"exp_decay"</code> for exponential decay ZoI;</p></li>
<li><p><code>"Gauss"</code>, <code>"gaussian"</code>, or <code>"gaussian_decay"</code> for Gaussian decay ZoI;</p></li>
<li><p><code>"bartlett"</code>, <code>"bartlett_decay"</code>, <code>"linear_decay"</code>, or <code>"tent_decay"</code>
for linear decay ZoI;</p></li>
<li><p><code>"rectangle"</code> or <code>"box"</code> for a rectangular ZoI.
There might be some correspondence between the weight matrix <code>type</code>
in <code>filter_create</code> and other similar functions (e.g. <code>type = "rectangle"</code>
and <code>type = "boxcar"</code> in <code><a href="https://rdrr.io/pkg/smoothie/man/kernel2dmeitsjer.html" class="external-link">smoothie::kernel2dmeitsjer()</a></code> or
<code>type = "Gauss"</code> in <code><a href="https://rdrr.io/pkg/terra/man/focalMat.html" class="external-link">terra::focalMat()</a></code> with parameter
<code>type = "gauss"</code> n <a href="smoothie::kernel2dmeitsjer">smoothie::kernel2dmeitsjer</a>); however, the
interpretation of the parameters used to
define these matrices is different between functions.</p></li>
</ul></dd>


<dt>zoi_limit</dt>
<dd><p><code>[numeric(1)=0.05]</code> <br> For non-vanishing filters
(e.g. <code>exp_decay</code>, <code>gaussian_decay</code>), this value is used to set the relationship
between the ZoI radius and the decay functions:
<code>radius</code> is defined as the minimum distance <code>x</code> at which the ZoI assumes values
below <code>zoi_limit</code>. The default is 0.05. This parameter is used only
if <code>radius</code> is not <code>NULL</code>.</p></dd>


<dt>half_life</dt>
<dd><p><code>[numeric(1)=NULL]</code> <br> Half life of the exponential decay
function, in meters. By definition, the half life is
the distance where the exponential decay function reaches 0.5 of its
maximum value. For the <code>exp_decay</code> function,
if the ZoI radius parameter is null (<code>radius = NULL</code>), the value of the
exponential half life (<code>half_life = log(2)/lambda</code>) can used to parameterize the
exponential decay function. See details in <code><a href="zoi_functions.html">zoi_functions()</a></code>.</p></dd>


<dt>zoi_hl_ratio</dt>
<dd><p><code>[numeric(1)=6]</code> <br> For the <code>exp_decay</code> function,
if both the ZoI radius <code>radius</code> and <code>zoi_hl_ratio</code> are given and
<code>half_life</code> is <code>NULL</code>, this value is used
to set the ZoI radius (and <code>zoi_limit</code> is ignored).
<code>zoi_hl_ratio</code> is the ratio between the
ZoI radius value and the half life of the exponential function.
For instance, if <code>radius = 1200</code> and <code>zoi_hl_ratio = 6</code>, this means
<code>half_life</code> is 200. As a consequence, the exponential decay ZoI function
decreases to 0.5 at distance 200, and the ZoI radius = 1200
is defined as the distance
at which the ZoI decreases to 0.5**6 = 0.015625.</p></dd>


<dt>sigma</dt>
<dd><p><code>[numeric(1)=NULL]</code> <br> Standard deviation of the Gaussian
function. It related to the Gaussian decay rate \(\lambda\) as
<code>lambda = 1/(2*sigma^2)</code>. Only considered to compute the ZoI
for the <code>gaussian_decay</code> function when the ZoI radius parameter is null
(<code>radius = NULL</code>).</p></dd>


<dt>min_intensity</dt>
<dd><p><code>[numeric(1)=0.01]</code> <br> Minimum intensity of the
exponential and Gaussian decay functions to
define the radius of the window that define the filter.</p></dd>


<dt>max_dist</dt>
<dd><p><code>[numeric(1)=50000]</code> <br> Maximum size (in meters) to
define the radius of the window that defines the filter. Only
applicable for exponential and Gaussian decay functions.</p></dd>


<dt>normalize</dt>
<dd><p><code>[logical(1)=FALSE]</code> <br> Whether the matrix should be normalized (sum of all cells is 1 if
<code>normalize = TRUE</code>) or kept as it is (default, <code>normalize = FALSE</code>).</p></dd>


<dt>divisor</dt>
<dd><p><code>[numeric(1)=1]</code> <br> By default, 1. This is the divisor of the neighborhood
matrix when used within <code>r.mfilter</code>. According the the module documentation, "The filter process produces a new
category value for each cell in the input raster map layer by multiplying the category values of the cells
in the n x n neighborhood around the center cell by the corresponding matrix value and adding them together.
If a divisor is specified, the sum is divided by this divisor." <br>
If the divisor is zero, "then the divisor is computed for each cell as the sum of the MATRIX values where
the corresponding input cell is non-null." In other words, the output map will be rescaled to the
interval $0,1$. If <code>normalize = TRUE</code>, the divisor is set to <code>n*n</code>.</p></dd>


<dt>round_vals</dt>
<dd><p><code>[numeric(1)=NULL]</code> <br> Number of digits for rounding the weights
in the output matrix. If <code>NULL</code> (default), weights are not rounded.</p></dd>


<dt>save_txt</dt>
<dd><p><code>[logical(1)=FALSE]</code> <br> Should the ZoI matrix be saved in an external
text file? If <code>FALSE</code> (default), the output matrix is just printed within the R session.</p></dd>


<dt>save_format</dt>
<dd><p><code>[character(1)="GRASS_rmfilter"]{"GRASS_rmfilter", "raw"}</code> <br>
Format in which the function should be saved. Currently, either of the two options:</p><ul><li><p>GRASS GIS format for the module <code>r.mfilter</code>
(<code>save_format = "GRASS_rmfilter"</code>), see details <a href="https://grass.osgeo.org/grass78/manuals/r.mfilter.html" class="external-link">here</a>);</p></li>
<li><p>raw matrix (<code>save_format = "raw"</code>), in which only the values of the matrix are printed.</p></li>
</ul></dd>


<dt>save_folder</dt>
<dd><p><code>[character(1)=NULL]</code> <br> Path to the folder where the matrix file should be written.
If <code>NULL</code>, the current working directory is used.</p></dd>


<dt>save_file</dt>
<dd><p><code>[character(1)=NULL]</code> <br> Name of the output file, generally a ".txt" file.
If <code>NULL</code>, a standard filename is created, using the <code>type</code> and <code>radius</code>. E.g. "filter_bartlett2000.txt".</p></dd>


<dt>parallel</dt>
<dd><p><code>[logical(1)=TRUE]</code> <br> Whether the computation should be paralelized or not (details in
the documentation of the <a href="https://grass.osgeo.org/grass78/manuals/r.mfilter.html" class="external-link"><code>r.mfilter</code></a> module).</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A matrix with the weight values. In the context of cumulative impact assessment, we call it a
zone of influence (ZoI) matrix used to compute the cumulative zone of influence. If <code>save_txt = TRUE</code>,
the matrix is saved in an output text file, e.g. to be used with external software.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The function creates \(n\) x \(n\) ZoI or weight matrices based on
functions with different shapes and parameterized with the ZoI radius, where
\(n\) is the dimension of the matrix.
For some functions (e.g. threshold decay, linear decay),
the size of the matrix is defined by the ZoI radius, in meters,
given the intended resolution (parameter <code>r</code>), potentially adding new lines
and columns with value zero to keep \(n\) an odd number.
For non-vanishing function (e.g. exponential or Gaussian decay),
even though the function is parameterized with the ZoI radius the size of
the matrix can go beyond this radius. In this case, the size of the matrix
\(n\) is defined either by a minimum intensity function value
(parameter <code>min_intensity</code>) or by a maximum distance for
the matrix radius (parameter <code>min_dist</code>, which can be set to be the <code>radius</code>).
Keeping \(n\) at a reasonable size guarantees that the neighborhood
analysis using such input weight matrices is computationally feasible.</p>
<p>Possible future implementation: compare results with
<code><a href="https://rdrr.io/pkg/smoothie/man/kernel2dsmooth.html" class="external-link">smoothie::kernel2dsmooth()</a></code> and <code><a href="https://rdrr.io/pkg/smoothie/man/kernel2dmeitsjer.html" class="external-link">smoothie::kernel2dmeitsjer()</a></code>,
maybe wrap some options here.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>See <code><a href="zoi_functions.html">zoi_functions()</a></code> for some ZoI function shapes and
<code><a href="filter_save.html">filter_save()</a></code> for options to save the ZoI matrix as a text file. <br>
See also <code><a href="https://rdrr.io/pkg/smoothie/man/kernel2dmeitsjer.html" class="external-link">smoothie::kernel2dmeitsjer()</a></code>, <code><a href="https://rdrr.io/pkg/terra/man/focalMat.html" class="external-link">terra::focalMat()</a></code>, and
<code><a href="https://rdrr.io/pkg/raster/man/focalWeight.html" class="external-link">raster::focalWeight()</a></code> for other functions to create filters or weight matrices. <br>
See
<a href="https://grass.osgeo.org/grass80/manuals/r.mfilter.html" class="external-link">r.mfilter</a>,
<a href="https://grass.osgeo.org/grass80/manuals/r.resamp.filter.html" class="external-link">r.resamp.filter</a>, and
<a href="https://grass.osgeo.org/grass80/manuals/r.neighbors.html" class="external-link">r.neighbors</a> for
GRASS GIS uses of filters in neighborhood analysis.</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/terra/" class="external-link">terra</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># load example - raster of tourist private cabins</span></span></span>
<span class="r-in"><span><span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"raster/sample_area_cabins.tif"</span>, package<span class="op">=</span><span class="st">"oneimpact"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># terra::ext(r)[1:2] %&gt;% diff</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># set value zero where there are no cabins</span></span></span>
<span class="r-in"><span><span class="va">r</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># create exponential filter</span></span></span>
<span class="r-in"><span><span class="va">filt_exp1000</span> <span class="op">&lt;-</span> <span class="fu">filter_create</span><span class="op">(</span><span class="va">r</span>, radius <span class="op">=</span> <span class="fl">1000</span>,</span></span>
<span class="r-in"><span>                              zoi_limit <span class="op">=</span> <span class="fl">0.01</span>,</span></span>
<span class="r-in"><span>                              type <span class="op">=</span> <span class="st">"exp_decay"</span>,</span></span>
<span class="r-in"><span>                              max_dist <span class="op">=</span> <span class="fl">5000</span>,</span></span>
<span class="r-in"><span>                              normalize <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">filt_exp3000</span> <span class="op">&lt;-</span> <span class="fu">filter_create</span><span class="op">(</span><span class="va">r</span>, radius <span class="op">=</span> <span class="fl">3000</span>,</span></span>
<span class="r-in"><span>                              zoi_limit <span class="op">=</span> <span class="fl">0.01</span>,</span></span>
<span class="r-in"><span>                              type <span class="op">=</span> <span class="st">"exp_decay"</span>,</span></span>
<span class="r-in"><span>                              max_dist <span class="op">=</span> <span class="fl">5000</span>,</span></span>
<span class="r-in"><span>                              normalize <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># use exponential filter</span></span></span>
<span class="r-in"><span><span class="va">neigh_r_exp1000</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/focal.html" class="external-link">focal</a></span><span class="op">(</span><span class="va">r</span>, <span class="va">filt_exp1000</span>, fun <span class="op">=</span> <span class="st">"sum"</span>,</span></span>
<span class="r-in"><span>                                na.policy <span class="op">=</span> <span class="st">"omit"</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">neigh_r_exp3000</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/focal.html" class="external-link">focal</a></span><span class="op">(</span><span class="va">r</span>, <span class="va">filt_exp3000</span>, fun <span class="op">=</span> <span class="st">"sum"</span>,</span></span>
<span class="r-in"><span>                                na.policy <span class="op">=</span> <span class="st">"omit"</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># plot</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">r</span>, <span class="va">neigh_r_exp1000</span>, <span class="va">neigh_r_exp3000</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>     main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"original"</span>, <span class="st">"exp filter 1000m"</span>, <span class="st">"exp filter 3000m"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="filter_create-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># create step filter</span></span></span>
<span class="r-in"><span><span class="va">filt_step3000</span> <span class="op">&lt;-</span> <span class="fu">filter_create</span><span class="op">(</span><span class="va">r</span>, radius <span class="op">=</span> <span class="fl">3000</span>, type <span class="op">=</span> <span class="st">"step"</span>,</span></span>
<span class="r-in"><span>                               normalize <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># use step filter</span></span></span>
<span class="r-in"><span><span class="va">neigh_r_step3000</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/focal.html" class="external-link">focal</a></span><span class="op">(</span><span class="va">r</span>, <span class="va">filt_step3000</span>, fun <span class="op">=</span> <span class="st">"sum"</span>,</span></span>
<span class="r-in"><span>                                 na.policy <span class="op">=</span> <span class="st">"omit"</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># plot</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">neigh_r_exp3000</span>, <span class="va">neigh_r_step3000</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>     main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"exp filter 3000m"</span>, <span class="st">"step filter 3000m"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="filter_create-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># plot(app(c(neigh_r_exp3000, neigh_r_step3000), "diff"))</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># create bartlett (linear/tent decay) filter</span></span></span>
<span class="r-in"><span><span class="va">filt_bart3000</span> <span class="op">&lt;-</span> <span class="fu">filter_create</span><span class="op">(</span><span class="va">r</span>, radius <span class="op">=</span> <span class="fl">3000</span>, type <span class="op">=</span> <span class="st">"bartlett"</span>,</span></span>
<span class="r-in"><span>                               normalize <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># use bartlett filter</span></span></span>
<span class="r-in"><span><span class="va">neigh_r_bart3000</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/focal.html" class="external-link">focal</a></span><span class="op">(</span><span class="va">r</span>, <span class="va">filt_bart3000</span>, fun <span class="op">=</span> <span class="st">"sum"</span>,</span></span>
<span class="r-in"><span>                                 na.policy <span class="op">=</span> <span class="st">"omit"</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># create Gaussian filter - parameterized with zoi</span></span></span>
<span class="r-in"><span><span class="va">filt_gauss3000</span> <span class="op">&lt;-</span> <span class="fu">filter_create</span><span class="op">(</span><span class="va">r</span>, radius <span class="op">=</span> <span class="fl">3000</span>,</span></span>
<span class="r-in"><span>                                type <span class="op">=</span> <span class="st">"Gauss"</span>,</span></span>
<span class="r-in"><span>                                zoi_limit <span class="op">=</span> <span class="fl">0.01</span>,</span></span>
<span class="r-in"><span>                                normalize <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># use Gaussian filter</span></span></span>
<span class="r-in"><span><span class="va">neigh_r_gauss3000</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/focal.html" class="external-link">focal</a></span><span class="op">(</span><span class="va">r</span>, <span class="va">filt_gauss3000</span>, fun <span class="op">=</span> <span class="st">"sum"</span>,</span></span>
<span class="r-in"><span>                                  na.policy <span class="op">=</span> <span class="st">"omit"</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># plot</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">neigh_r_exp3000</span>, <span class="va">neigh_r_step3000</span>, <span class="va">neigh_r_bart3000</span>, <span class="va">neigh_r_gauss3000</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>     main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"exp filter 3000m"</span>, <span class="st">"step filter 3000m"</span>,</span></span>
<span class="r-in"><span>              <span class="st">"Bartlett filter 3000m"</span>, <span class="st">"Gaussian filter 3000m"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="filter_create-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># plot(app(c(neigh_r_exp3000, neigh_r_bart3000), "diff"))</span></span></span>
<span class="r-in"><span><span class="co"># plot(app(c(neigh_r_step3000, neigh_r_bart3000), "diff"))</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Not run</span></span></span>
<span class="r-in"><span><span class="co"># save outside R for use in GRASS GIS</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu">filter_create</span><span class="op">(</span><span class="va">r</span>, radius <span class="op">=</span> <span class="fl">1000</span>,</span></span>
<span class="r-in"><span>                type <span class="op">=</span> <span class="st">"bartlett"</span>,</span></span>
<span class="r-in"><span>                max_dist <span class="op">=</span> <span class="fl">5000</span>,</span></span>
<span class="r-in"><span>                normalize <span class="op">=</span> <span class="cn">T</span>, save_txt <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Bernardo Niebuhr, Manuela Panzacchi, Bram van Moorter.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer></div>

  

  

  </body></html>

