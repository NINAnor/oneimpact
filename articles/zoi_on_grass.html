<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Computing zones of influence on GRASS GIS through the oneimpact package in R • oneimpact</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Computing zones of influence on GRASS GIS through the oneimpact package in R">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">oneimpact</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/oneimpact.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/oneimpact.html">Getting started</a></li>
    <li><a class="dropdown-item" href="../articles/computing_zoi.html">Computing zones of influence</a></li>
    <li><a class="dropdown-item" href="../articles/zoi_on_grass.html">Zones of influence on GRASS GIS</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/NINAnor/oneimpact/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Computing zones of influence on GRASS GIS through the oneimpact package in R</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/NINAnor/oneimpact/blob/main/vignettes/zoi_on_grass.Rmd" class="external-link"><code>vignettes/zoi_on_grass.Rmd</code></a></small>
      <div class="d-none name"><code>zoi_on_grass.Rmd</code></div>
    </div>

    
    
<p>The computation of zones of influence (ZOI) in useful to assess
whether the effect of a given anthropogenic infrastructure, disturbance,
or landscape variable affect an ecological response variable beyond its
spatial delimitation. Computing zones of influence for large maps with
fine resolution though, is tricky because of computing and memory
limitations in processing raster maps in R. To deal with that, the
<code>oneimpact</code> package offers tools to compute the ZOI in <a href="https://grass.osgeo.org/" class="external-link">GRASS GIS</a>, a powerful, open-source ,
using the package <a href="https://rsbivand.github.io/rgrass/" class="external-link"><code>rgrass</code></a> to
link R and GRASS. Here we provide an example and some comments on how to
compute ZOI metrics in GRASS GIS via R.</p>
<p>For an introduction to the zone of influence approach in R, look at
the <a href="https://ninanor.github.io/oneimpact/articles/oneimpact.html">Getting
started</a> and <a href="https://ninanor.github.io/oneimpact/articles/computing_zoi.html">Computing
zones of influence</a> introdutory vignettes.</p>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>To compute ZOI metrics in GRASS GIS, we can use the same function
used to compute ZOI in R, <code><a href="../reference/calc_zoi.html">calc_zoi()</a></code> (or
<code><a href="../reference/calc_zoi_nearest.html">calc_zoi_nearest()</a></code> and <code>calc_zoi_cumulative</code> for
only the nearest and cumulative ZOI metrics), adding a parameter
<code>where = "GRASS"</code>. However, the computation in GRASS GIS is
slighly different from doing the same in R. Here are some key
differences:</p>
<ul>
<li>raster processing is made in GRASS GIS, so it requires an active
connection between the R session and a GRASS GIS location and
mapset;</li>
<li>the input raster maps representing infrastructure or disturbance
might be loaded into the GRASS GIS location/mapset R is connected to.
This might be done through the <code>rgrass</code> package;</li>
<li>once the input raster maps are loaded in GRASS, the input to the
<code><a href="../reference/calc_zoi.html">calc_zoi()</a></code> function is not a raster object in R but a
string with the name of the map in the GRASS mapset;</li>
<li>after processing, ZOI maps are saved within the GRASS GIS location
and mapset. To retrieve them, one must use the <code>rgrass</code>
pacakge to import the maps into R or outside to a working folder.</li>
</ul>
<p>Below we show how to do these steps to compute the ZOI and provide a
few comments.</p>
</div>
<div class="section level2">
<h2 id="establishing-a-connection-between-r-and-grass">Establishing a connection between R and GRASS<a class="anchor" aria-label="anchor" href="#establishing-a-connection-between-r-and-grass"></a>
</h2>
<div class="section level3">
<h3 id="downloading-and-installing-grass-gis">Downloading and installing GRASS GIS<a class="anchor" aria-label="anchor" href="#downloading-and-installing-grass-gis"></a>
</h3>
<p>The first requirement to compute ZOI metrics in GRASS is to have
GRASS GIS installed. GRASS can be freely downloaded and installed in
most operational systems (Windows, Linux, MacOS). For more information
on installations, please see the official <a href="https://grass.osgeo.org/download/" class="external-link">GRASS Downloads webpage</a>.
The website also provides <a href="https://grass.osgeo.org/learn/" class="external-link">helpful manuals, tutorials, and
videos</a> and various languages for first time and experienced
users.</p>
</div>
<div class="section level3">
<h3 id="connecting-r-to-grass-gis">Connecting R to GRASS GIS<a class="anchor" aria-label="anchor" href="#connecting-r-to-grass-gis"></a>
</h3>
<p>GRASS GIS has a slighly different project organization, if compared
to other popular GIS software such as ArcGIS and QGIS. GRASS projects
are called <strong>Locations</strong>, which are defined by a single <a href="https://en.wikipedia.org/wiki/Geodetic_datum" class="external-link">geodetic datum</a>
and <a href="https://rspatial.org/terra/spatial/6-crs.html" class="external-link">coordinate
reference system (CRS)</a>. This means that all maps of all types
(e.g. vector, raster) within a location have the very same CRS, what
assures all data is processed correctly. Each location has a main folder
called <strong>PERMANENT</strong> and might have multiple other folders;
these folders are called <strong>Mapsets</strong>. See <a href="https://neteler.gitlab.io/grass-gis-analysis/01_grass-gis-basics/" class="external-link">this
tutorial</a> for more information on the GRASS database and location
structure.</p>
<div class="section level4">
<h4 id="running-grass-from-r">Running GRASS from R<a class="anchor" aria-label="anchor" href="#running-grass-from-r"></a>
</h4>
<p>When connecting R to GRASS, R might be connected to a given GRASS
location and mapset through the function
<code><a href="https://osgeo.github.io/rgrass/reference/initGRASS.html" class="external-link">rgrass::initGRASS()</a></code>. One must provide to this call the
folder where the GRASS GIS executable files are found (parameter
<code>gisBase</code>), as well as the folder where the project is
located (parameter <code>gisDbase</code>), the location name (parameter
<code>location</code>) and the mapset name (parameter
<code>mapset</code>). The function might be used to connect to an
already existing location or create a new one, if it does not exist.</p>
<p>For illustration, here we create a new location to work on the
<code>oneimpact</code> examples. To do so, we use as a reference (for
defining the datum and CRS of the GRASS location) the map of number of
private tourist cabins in a sample area in Southern Norway, stored in
the <code>oneimpact</code> package (see
<code><a href="../reference/sample_area_cabins_count.tif.html">?sample_area_cabins_count.tif</a></code> for more information). We
first load this data set.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/NINAnor/oneimpact" class="external-link">oneimpact</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://osgeo.github.io/rgrass/" class="external-link">rgrass</a></span><span class="op">)</span> <span class="co"># for connecting R and GRASS</span></span>
<span><span class="co">#&gt; GRASS GIS interface loaded with GRASS version: sh: line 1: g.version: command not found</span></span>
<span><span class="co">#&gt; and location: ETRS_33N/</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span> <span class="co"># for geodata in R</span></span>
<span><span class="co">#&gt; terra 1.8.42</span></span>
<span></span>
<span><span class="co"># load cabins raster data into R</span></span>
<span><span class="op">(</span><span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"raster/sample_area_cabins_count.tif"</span>, package <span class="op">=</span> <span class="st">"oneimpact"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "/home/runner/work/_temp/Library/oneimpact/raster/sample_area_cabins_count.tif"</span></span>
<span><span class="va">cabins_count</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span></span></code></pre></div>
<p>Next, we need to know what is the path of the folder where GRASS GIS
executable files are located. The following command works in Linux,
MacOS, and within the OSGeo4W in Windows:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># For linux or within OSGeo4W shell</span></span>
<span><span class="va">grassdir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.html" class="external-link">system</a></span><span class="op">(</span><span class="st">"grass --config path"</span>, intern <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">grassdir</span></span>
<span><span class="co">#&gt; [1] "/usr/lib/grass83"</span></span></code></pre></div>
<p>Now we can create a GRASS GIS location and connect our R session to
it:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gisDB</span> <span class="op">&lt;-</span> <span class="st">"."</span> <span class="co"># create location and mapset in the working directory</span></span>
<span><span class="va">loc</span> <span class="op">&lt;-</span> <span class="st">"test_location/"</span> <span class="co"># name of the location</span></span>
<span><span class="va">ms</span> <span class="op">&lt;-</span> <span class="st">"PERMANENT"</span> <span class="co"># name of the mapset</span></span>
<span><span class="co"># create grass db and connect</span></span>
<span><span class="fu">rgrass</span><span class="fu">::</span><span class="fu"><a href="https://osgeo.github.io/rgrass/reference/initGRASS.html" class="external-link">initGRASS</a></span><span class="op">(</span>gisBase <span class="op">=</span> <span class="va">grassdir</span>,</span>
<span>                  SG <span class="op">=</span> <span class="va">cabins_count</span>, <span class="co"># use map to define location projection</span></span>
<span>                  home <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                  gisDbase <span class="op">=</span> <span class="va">gisDB</span>,</span>
<span>                  location <span class="op">=</span> <span class="va">loc</span>,</span>
<span>                  mapset <span class="op">=</span> <span class="va">ms</span>,</span>
<span>                  override <span class="op">=</span> <span class="cn">TRUE</span>, <span class="op">)</span></span>
<span><span class="co">#&gt; gisdbase    . </span></span>
<span><span class="co">#&gt; location    test_location/ </span></span>
<span><span class="co">#&gt; mapset      PERMANENT </span></span>
<span><span class="co">#&gt; rows        361 </span></span>
<span><span class="co">#&gt; columns     478 </span></span>
<span><span class="co">#&gt; north       6658900 </span></span>
<span><span class="co">#&gt; south       6622800 </span></span>
<span><span class="co">#&gt; west        146900 </span></span>
<span><span class="co">#&gt; east        194700 </span></span>
<span><span class="co">#&gt; nsres       100 </span></span>
<span><span class="co">#&gt; ewres       100 </span></span>
<span><span class="co">#&gt; projection:</span></span>
<span><span class="co">#&gt;  PROJCRS["unknown",</span></span>
<span><span class="co">#&gt;     BASEGEOGCRS["grs80",</span></span>
<span><span class="co">#&gt;         DATUM["European Terrestrial Reference System 1989",</span></span>
<span><span class="co">#&gt;             ELLIPSOID["Geodetic_Reference_System_1980",6378137,298.257222101,</span></span>
<span><span class="co">#&gt;                 LENGTHUNIT["metre",1]],</span></span>
<span><span class="co">#&gt;             ID["EPSG",6258]],</span></span>
<span><span class="co">#&gt;         PRIMEM["Greenwich",0,</span></span>
<span><span class="co">#&gt;             ANGLEUNIT["degree",0.0174532925199433,</span></span>
<span><span class="co">#&gt;                 ID["EPSG",9122]]]],</span></span>
<span><span class="co">#&gt;     CONVERSION["Transverse Mercator",</span></span>
<span><span class="co">#&gt;         METHOD["Transverse Mercator",</span></span>
<span><span class="co">#&gt;             ID["EPSG",9807]],</span></span>
<span><span class="co">#&gt;         PARAMETER["Latitude of natural origin",0,</span></span>
<span><span class="co">#&gt;             ANGLEUNIT["degree",0.0174532925199433],</span></span>
<span><span class="co">#&gt;             ID["EPSG",8801]],</span></span>
<span><span class="co">#&gt;         PARAMETER["Longitude of natural origin",15,</span></span>
<span><span class="co">#&gt;             ANGLEUNIT["degree",0.0174532925199433],</span></span>
<span><span class="co">#&gt;             ID["EPSG",8802]],</span></span>
<span><span class="co">#&gt;         PARAMETER["Scale factor at natural origin",0.9996,</span></span>
<span><span class="co">#&gt;             SCALEUNIT["unity",1],</span></span>
<span><span class="co">#&gt;             ID["EPSG",8805]],</span></span>
<span><span class="co">#&gt;         PARAMETER["False easting",500000,</span></span>
<span><span class="co">#&gt;             LENGTHUNIT["metre",1],</span></span>
<span><span class="co">#&gt;             ID["EPSG",8806]],</span></span>
<span><span class="co">#&gt;         PARAMETER["False northing",0,</span></span>
<span><span class="co">#&gt;             LENGTHUNIT["metre",1],</span></span>
<span><span class="co">#&gt;             ID["EPSG",8807]]],</span></span>
<span><span class="co">#&gt;     CS[Cartesian,2],</span></span>
<span><span class="co">#&gt;         AXIS["easting",east,</span></span>
<span><span class="co">#&gt;             ORDER[1],</span></span>
<span><span class="co">#&gt;             LENGTHUNIT["metre",1,</span></span>
<span><span class="co">#&gt;                 ID["EPSG",9001]]],</span></span>
<span><span class="co">#&gt;         AXIS["northing",north,</span></span>
<span><span class="co">#&gt;             ORDER[2],</span></span>
<span><span class="co">#&gt;             LENGTHUNIT["metre",1,</span></span>
<span><span class="co">#&gt;                 ID["EPSG",9001]]]]</span></span></code></pre></div>
<p>Notice that, in the code above, a few additional parameters were
filled. First, the <code>SG = cabins_count</code> parameter defined the
map of cabins as the reference to define the CRS of the created
location. Second, we created a location in a temporary folder using
<code>home = tempdir()</code>. While this is ok for tests and
demonstration purposes like this tutorial, we do not recommend you to
use it when processing maps for other purposes, since the data might be
lost after the connection to GRASS is closed.</p>
<p>As a proof to check if the connection between R and GRASS is active,
the <code><a href="https://osgeo.github.io/rgrass/reference/initGRASS.html" class="external-link">initGRASS()</a></code> function shows a series of information
about the grass database and location. The same might be checked at any
time by using the <code><a href="https://osgeo.github.io/rgrass/reference/gmeta.html" class="external-link">rgrass::gmeta()</a></code> function:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># check grass connection</span></span>
<span><span class="fu">rgrass</span><span class="fu">::</span><span class="fu"><a href="https://osgeo.github.io/rgrass/reference/gmeta.html" class="external-link">gmeta</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>This command shows all the information on the grass database,
location, mapset, and reference system. Besides, it provides information
about the GRASS working computational region (number of
<code>rows</code> and <code>columns</code> of the region;
<code>north</code>, <code>south</code>, <code>west</code>, and
<code>east</code> boundaries of the region extent; and region resolution
in the north-south and east-west directions, <code>nsres</code> and
<code>ewres</code>). Differently from other GIS, GRASS works based on
computational regions to perform map processing. This means that,
regardless of the extent and resolution of the input maps, it is
possible to set a specific desired extent and resolution as the output
for most of the GRASS GIS tools. More information on GRASS computational
regions can be found <a href="https://neteler.gitlab.io/grass-gis-analysis/01_grass-gis-basics/#concept-of-computational-region" class="external-link">here</a>.</p>
</div>
<div class="section level4">
<h4 id="running-r-within-grass">Running R within GRASS<a class="anchor" aria-label="anchor" href="#running-r-within-grass"></a>
</h4>
<p>Another option is to open a GRASS GIS session and run R within the
GRASS shell. Too know more about this option, please look at these GRASS
GIS <a href="https://grasswiki.osgeo.org/wiki/R_statistics/rgrass" class="external-link">wiki</a>.</p>
</div>
</div>
<div class="section level3">
<h3 id="notes-in-grass-installation-and-connections-on-windows">Notes in GRASS installation and connections on Windows<a class="anchor" aria-label="anchor" href="#notes-in-grass-installation-and-connections-on-windows"></a>
</h3>
<p>It is possible to install GRASS on Windows operational systems in two
ways, and it might be a little tricky to connect R and GRASS.</p>
<div class="section level4">
<h4 id="standalone-installation">Standalone installation<a class="anchor" aria-label="anchor" href="#standalone-installation"></a>
</h4>
<p>The first option is to download a <a href="https://grass.osgeo.org/download/windows/" class="external-link">standalone
installer</a> and install a given GRASS GIS version. If you do so, the
code above should work, except the command
<code>system("grass78 --config path", intern = TRUE)</code>. In this
case, the <code>grassdir</code> object with the path to the executable
GRASS files should look like:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="co"># If you used the standalone installer in Windows</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>grassdir <span class="ot">&lt;-</span> <span class="st">"C:\Programs\GRASS GIS 7.8"</span> <span class="co"># Correct if the path is different</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="installation-through-osgeo4w">Installation through OSGeo4W<a class="anchor" aria-label="anchor" href="#installation-through-osgeo4w"></a>
</h4>
<p>Another option on Windows is to use <a href="https://grass.osgeo.org/download/windows/" class="external-link">OSGeo4W</a>. OSGeo4W is
an installer for a broad set of open source geospatial software packages
including GRASS GIS as well as many other packages (QGIS, GDAL/OGR, and
more). Here it is possible to choose which version of GRASS GIS to
install and choose many other installation setting besides the
default.</p>
<p>When GRASS is installed through OSGeo4W, though, R must be opened
from the OSGeo4W shell for the connection between R and GRASS to work
through the <code>rgrass</code> package. See the documentation for the
<code><a href="https://osgeo.github.io/rgrass/reference/initGRASS.html" class="external-link">rgrass::initGRASS()</a></code> function and <a href="https://github.com/NINAnor/oneimpact/issues/10" class="external-link">this issue</a> for
more information on the connection between R and GRASS on Windows.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="computing-the-zones-of-influence">Computing the zones of influence<a class="anchor" aria-label="anchor" href="#computing-the-zones-of-influence"></a>
</h2>
<div class="section level3">
<h3 id="loading-input-maps-into-grass">Loading input maps into GRASS<a class="anchor" aria-label="anchor" href="#loading-input-maps-into-grass"></a>
</h3>
<p>Before computing the ZOI metrics, the input infrastructure or
disturbance maps must be loaded into GRASS. If the maps are already open
in our R session, it is possible to write them into our GRASS mapset
using the <code><a href="https://osgeo.github.io/rgrass/reference/read_RAST.html" class="external-link">rgrass::write_RAST()</a></code> function:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># write raster into GRASS</span></span>
<span><span class="fu">rgrass</span><span class="fu">::</span><span class="fu"><a href="https://osgeo.github.io/rgrass/reference/read_RAST.html" class="external-link">write_RAST</a></span><span class="op">(</span><span class="va">cabins_count</span>, </span>
<span>                   vname <span class="op">=</span> <span class="st">"cabins_count"</span>, <span class="co"># name of the map in GRASS</span></span>
<span>                   flags <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"o"</span>, <span class="st">"quiet"</span>, <span class="st">"overwrite"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>In some cases, there might be small, negligible differences between
the GRASS location CRS and the the input map CRS. In such cases where
this difference might be ignored, the parameter <code>flags = "o"</code>
might be added to ignore the differences (look <a href="https://grass.osgeo.org/grass82/manuals/r.in.gdal.html" class="external-link">here</a>
for more details on the <code>-o</code> flag). Likewise, if the map
already exists in the GRASS location and we want to overwrite it, we
must add the <code>overwrite = TRUE</code> parameter to the
function.</p>
<p>Another way of loading a map into a GRASS location and mapset
directly from a folder in your computer, without the need to pre-load it
into R, is to use the <a href="https://grass.osgeo.org/grass82/manuals/r.out.gdal.html" class="external-link"><code>r.in.gdal</code></a>
or <a href="https://grass.osgeo.org/grass82/manuals/r.import.html" class="external-link"><code>r.import</code></a>
GRASS tools through the <code><a href="https://osgeo.github.io/rgrass/reference/execGRASS.html" class="external-link">rgrass::execGRASS()</a></code> function. The
function <code><a href="https://osgeo.github.io/rgrass/reference/execGRASS.html" class="external-link">execGRASS()</a></code> provides a way of running GRASS
modules and addons directly, as if we were running them through the
GRASS console.</p>
<p>In this case, the following command would also work:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get path to the raster file</span></span>
<span><span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"raster/sample_area_cabins_count.tif"</span>, package <span class="op">=</span> <span class="st">"oneimpact"</span><span class="op">)</span></span>
<span><span class="va">f</span></span>
<span></span>
<span><span class="co"># load this file to the GRASS mapset</span></span>
<span><span class="fu">rgrass</span><span class="fu">::</span><span class="fu"><a href="https://osgeo.github.io/rgrass/reference/execGRASS.html" class="external-link">execGRASS</a></span><span class="op">(</span><span class="st">"r.in.gdal"</span>, input <span class="op">=</span> <span class="va">f</span>, </span>
<span>                  output <span class="op">=</span> <span class="st">"cabins_count"</span>, <span class="co"># name of the map in GRASS</span></span>
<span>                  flags <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"overwrite"</span>, <span class="st">"o"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="computing-the-zoi">Computing the ZOI<a class="anchor" aria-label="anchor" href="#computing-the-zoi"></a>
</h3>
<p>Now, computing the ZOI is very similar to the procedure in R with the
<code><a href="../reference/calc_zoi.html">calc_zoi()</a></code> function. We will here compute both the ZOI of
the nearest feature and the cumutive ZOI for cabins using a ZOI with a
linear decay (i.e. Bartlett) shape and radii of 500 and 1000 m.
Importantly, here the main input <code>x</code> for the
<code><a href="../reference/calc_zoi.html">calc_zoi()</a></code> funcion is a string with the name of the map
within the GRASS mapset (or a vector strings for multiple maps). To
inform R that we wish to make processing in GRASS, we must set
<code>where = "GRASS"</code>:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># compute zoi</span></span>
<span><span class="va">zoi_metrics</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calc_zoi.html">calc_zoi</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"cabins_count"</span>, <span class="co"># string as input</span></span>
<span>                        radius <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">500</span>, <span class="fl">1000</span><span class="op">)</span>,</span>
<span>                        type <span class="op">=</span> <span class="st">"bartlett"</span>,</span>
<span>                        zeroAsNA <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                        where <span class="op">=</span> <span class="st">"GRASS"</span>, </span>
<span>                        g_overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt;    0%   2%   4%   6%   8%  10%  12%  14%  16%  18%  20%  22%  24%  26%  28%  30%  32%  34%  36%  38%  40%  42%  44%  46%  48%  50%  52%  54%  56%  58%  60%  62%  64%  66%  68%  70%  72%  74%  76%  78%  80%  82%  84%  86%  88%  90%  92%  94%  96%  98% 100%</span></span>
<span><span class="co">#&gt; Removing raster &lt;cabins_count_zoi_nearest_euclidean&gt;</span></span>
<span><span class="co">#&gt; Removing raster &lt;temp_set_null_input&gt;</span></span>
<span></span>
<span><span class="co"># check the output</span></span>
<span><span class="va">zoi_metrics</span></span>
<span><span class="co">#&gt; [1] "cabins_count_zoi_nearest_bartlett500"    </span></span>
<span><span class="co">#&gt; [2] "cabins_count_zoi_nearest_bartlett1000"   </span></span>
<span><span class="co">#&gt; [3] "cabins_count_zoi_cumulative_bartlett500" </span></span>
<span><span class="co">#&gt; [4] "cabins_count_zoi_cumulative_bartlett1000"</span></span></code></pre></div>
<p>Notice that, differently from when <code><a href="../reference/calc_zoi.html">calc_zoi()</a></code> is run
entirely in R, the output object <code>zoi_metrics</code> is a vector of
strings specifying the name of the output maps computed in GRASS. Below
we show how to retrieve these maps into R or export them from GRASS into
a local folder.</p>
<p>Notice also that the <code>g_overwrite</code> parameter was used to
guarantee that, if there are already maps with similar names in the
GRASS GIS mapset, they will be overwritten. Other parameters to control
how <code><a href="../reference/calc_zoi.html">calc_zoi()</a></code> is computed in GRASS are available, all
following starting with <code>g_</code>. For instance, the name of the
output map (or pattern in the output names, when there is more than one
map or ZOI radius) might be determined using the
<code>g_output_map_name</code> parameter. If no parameter is specified,
the input map name is used, together with the ZOI metric, shape, and
radius, to create the name of the output maps. For more information on
GRASS GIS options for ZOI computation, see the documentation for
<code><a href="../reference/calc_zoi_nearest.html">calc_zoi_nearest()</a></code> and
<code><a href="../reference/calc_zoi_cumulative.html">calc_zoi_cumulative()</a></code>.</p>
</div>
</div>
<div class="section level2">
<h2 id="retrieving-outputs-from-grass">Retrieving outputs from GRASS<a class="anchor" aria-label="anchor" href="#retrieving-outputs-from-grass"></a>
</h2>
<p>Once the ZOI maps are calculated, we can retrieve them to R using the
function <code><a href="https://osgeo.github.io/rgrass/reference/read_RAST.html" class="external-link">rgrass::read_RAST()</a></code>. By default, this function
reads the rasters as a <code>SpatialGridDataFrame</code> object from the
<code>sp</code> package. Here we prefer to specify
<code>return_format = "terra"</code>, in case which the output is a
<em>terra</em> <code>SpatRaster</code> object.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># retireve maps</span></span>
<span><span class="va">cabins_zoi_cumulative</span> <span class="op">&lt;-</span> <span class="fu">rgrass</span><span class="fu">::</span><span class="fu"><a href="https://osgeo.github.io/rgrass/reference/read_RAST.html" class="external-link">read_RAST</a></span><span class="op">(</span><span class="va">zoi_metrics</span>, </span>
<span>                                           return_format <span class="op">=</span> <span class="st">"terra"</span>,</span>
<span>                                           flags <span class="op">=</span> <span class="st">"quiet"</span><span class="op">)</span></span>
<span><span class="va">cabins_zoi_cumulative</span></span>
<span><span class="co">#&gt; class       : SpatRaster </span></span>
<span><span class="co">#&gt; dimensions  : 361, 478, 4  (nrow, ncol, nlyr)</span></span>
<span><span class="co">#&gt; resolution  : 100, 100  (x, y)</span></span>
<span><span class="co">#&gt; extent      : 146900, 194700, 6622800, 6658900  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; coord. ref. : +proj=utm +zone=33 +ellps=GRS80 +units=m +no_defs </span></span>
<span><span class="co">#&gt; sources     : file440111edb1ba.grd  </span></span>
<span><span class="co">#&gt;               file4401dd13fd.grd  </span></span>
<span><span class="co">#&gt;               file44015d7e80eb.grd  </span></span>
<span><span class="co">#&gt;               file440153f39bce.grd  </span></span>
<span><span class="co">#&gt; color table : 1, 2, 3, 4 </span></span>
<span><span class="co">#&gt; names       : cabins_~lett500, cabins_~ett1000, cabins_~lett500, cabins_~ett1000 </span></span>
<span><span class="co">#&gt; min values  :               0,               0,         0.00000,          0.0000 </span></span>
<span><span class="co">#&gt; max values  :               1,               1,        86.69992,        192.6282</span></span></code></pre></div>
<p>Now we can plot the ZOI metrics computed in GRASS:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot ZOI metrics</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cabins_zoi_cumulative</span><span class="op">)</span></span></code></pre></div>
<p><img src="zoi_on_grass_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<p>From this point, the <code>oneimpact</code> vignette <a href="https://ninanor.github.io/oneimpact/articles/oneimpact.html">Getting
started</a> shows how it is possible to annotate biological data with
the ZOI variables computed for different variables to prepare data for a
multi-scale analysis on the effects of infrastructure and anthropogenic
disturbance on biological responses (see also Niebuhr et al,
<em>submitted</em>).</p>
</div>
<div class="section level2">
<h2 id="additional-resources">Additional resources<a class="anchor" aria-label="anchor" href="#additional-resources"></a>
</h2>
<div class="section level3">
<h3 id="different-algorithms-to-compute-the-cumulative-zone-of-influence">Different algorithms to compute the cumulative zone of
influence<a class="anchor" aria-label="anchor" href="#different-algorithms-to-compute-the-cumulative-zone-of-influence"></a>
</h3>
<p>In GRASS GIS, different algorithms might be used for the computation
of neighborhood analyses, which are the basis for the cumulative ZOI
calculation. The following GRASS tools are available to be used in
<code><a href="../reference/calc_zoi.html">calc_zoi()</a></code> in GRASS: <code>r.resamp.filter</code>,
<code>r.mfilter</code>, or <code>r.neighbors</code>. The module to be
used is controlled by the parameter <code>g_module</code>. Each of these
algorithms provide different capabilities and flexibility:</p>
<ul>
<li>
<code>r.resamp.filter</code> seems to be the fastest one in most
cases, but has less flexibility in the choice of the zone of influence
shapes. The algorithm calculates the weighted density of features, which
might be rescaled to the cumulative ZOI if the appropriate scaling
factor (calculated from the weight matrix) is provided. Currently only
the filters <code>type = "bartlett"</code> and <code>type = "box"</code>
are implemented in <code>oneimpact</code>. More information about the
algorithm <a href="https://grass.osgeo.org/grass82/manuals/r.resamp.filter.html" class="external-link">here</a>.</li>
<li>
<code>r.mfilter</code> (the default tools in the
<code><a href="../reference/calc_zoi.html">calc_zoi()</a></code> functions) is slower than
<code>r.resamp.filter</code> but much faster than
<code>r.neighbors</code>, and allows a flexible choice of the shape of
the zone of influence (the wight matrix shape). <code>r.mfilter</code>
is then the most indicated in terms of a balance between flexibility in
the choice of the ZOI shape and computation efficiency. The only
inconvenient of <code>r.mfilter</code> is that it creates an edge effect
with no information in the outer cells of a raster (the number of cells
correspond to <code>radius</code> or half the size of the weight
matrix), so if it is used the users should add a buffer area around the
input raster map, to avoid such edge effects. See for more details about
this issue, and <a href="https://grass.osgeo.org/grass82/manuals/r.mfilter.html" class="external-link">this
link</a> for more information on this tool.</li>
<li>
<code>r.neighbors</code> is considerably slower than the other
algorithms (from 10 to 100 times), but allows a flexible choice of the
ZOI shape. Contrary to <code>r.resamp.filter</code> and
<code>r.mfilter</code>, which can only perform a sum of pixel values
weighted by the input filter or ZOI, <code>r.neighbors</code> might
calculate many other statistical summaries within the window of
analysis, such as mean, median, standard deviation etc. In principle,
though, the sum is enough to compute the cumulative ZOI as formulated in
Niebuhr et al. (<em>submitted</em>) and proposed here.</li>
</ul>
</div>
<div class="section level3">
<h3 id="different-measures-of-distance-to-compute-the-zone-of-influence-of-the-nearest-feature">Different measures of distance to compute the zone of influence of
the nearest feature<a class="anchor" aria-label="anchor" href="#different-measures-of-distance-to-compute-the-zone-of-influence-of-the-nearest-feature"></a>
</h3>
<p>The metrics of ZOI of the nearest feature are based on maps of
distance form each pixel in the landscape to the nearest feature. They
are computed in GRASS through the <a href="https://grass.osgeo.org/grass78/manuals/r.grow.distance.html" class="external-link">r.grow.distance</a>
tool. This tool allows the computation of the distance to the nearest
feature based on different distance metrics: “euclidean”, “geodesic”,
“squared”, “maximum”, “manhattan”. This allows extra flexibility and
might be controlled in the <code><a href="../reference/calc_zoi.html">calc_zoi()</a></code> functions through the
<code>g_dist_metric</code> parameter. If
<code>g_dist_metric = "geodesic"</code> and one uses the option
<code>flags = "m"</code>, for instance, the computation of the distance
is made in meters even if the map is in geographical coordinate system
(Latitude-Longitude). Find more information at the GRASS GIS
documentation for this function <a href="https://grass.osgeo.org/grass82/manuals/r.grow.distance.html" class="external-link">here</a>.</p>
</div>
<div class="section level3">
<h3 id="additional-ancillary-functions">Additional ancillary functions<a class="anchor" aria-label="anchor" href="#additional-ancillary-functions"></a>
</h3>
<p>Additional examples for the computation of the ZOI in GRASS can be
found in the documentation of the <code><a href="../reference/calc_zoi_nearest.html">calc_zoi_nearest()</a></code> and
<code><a href="../reference/calc_zoi_cumulative.html">calc_zoi_cumulative()</a></code> functions. The <code>oneimpact</code>
package also provides a few other ancillary functions to help processing
maps within GRASS:</p>
<ul>
<li>The function <code><a href="../reference/grass_binarize.html">grass_binarize()</a></code> transforms continuous
maps into binary maps based on <code>breaks</code> to define discrete
categories. The output consists of maps with 1 for values above the
<code><a href="https://rdrr.io/r/base/Control.html" class="external-link">break</a></code> and 0 for values below it. It might be used for
preparing inputs to compute the ZOI based on continuous layers.</li>
<li>The function <code><a href="../reference/grass_v2rast_count.html">grass_v2rast_count()</a></code> rasterizes vectors
within GRASS by counting the number of features in each pixel. This is
usefull for large maps which are hard to be rasterized within R. See the
<a href="https://ninanor.github.io/oneimpact/articles/computing_zoi.html">Computing
zones of influence</a> vignette for a reasoning about where this might
be useful.</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Niebuhr, B. B., van Moorter, B., Stien, A., Tveraa, T., Strand, O.,
Langeland, K., Alam, M., Skarin, A., &amp; Panzacchi, M. Estimating the
cumulative impact and zone of influence of anthropogenic infrastructure
on biodiversity. <em>Methods in Ecology and Evolution</em>, 14,
2362–2375. <a href="https://doi.org/10.1111/2041-210X.14133" class="external-link uri">https://doi.org/10.1111/2041-210X.14133</a></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Bernardo Brandão Niebuhr, Manuela Panzacchi, Bram van Moorter.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
