<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Estimating zones of influence in resource selection functions using bagging and penalized regression • oneimpact</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Estimating zones of influence in resource selection functions using bagging and penalized regression">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">oneimpact</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/oneimpact.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/oneimpact.html">Getting started</a></li>
    <li><a class="dropdown-item" href="../articles/computing_zoi.html">Computing zones of influence</a></li>
    <li><a class="dropdown-item" href="../articles/zoi_on_grass.html">Zones of influence on GRASS GIS</a></li>
    <li><a class="dropdown-item" href="../articles/fitting_ZOI_logit.html">Estimating zones of influence using penalized regression</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/NINAnor/oneimpact/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Estimating zones of influence in resource selection functions using bagging and penalized regression</h1>
                        <h4 data-toc-skip class="author">Bernardo
Niebuhr</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/NINAnor/oneimpact/blob/main/vignettes/fitting_ZOI_logit.Rmd" class="external-link"><code>vignettes/fitting_ZOI_logit.Rmd</code></a></small>
      <div class="d-none name"><code>fitting_ZOI_logit.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="intro">Intro<a class="anchor" aria-label="anchor" href="#intro"></a>
</h2>
<p><strong>Add something introducing the idea of penalized regression in
this context</strong></p>
<p>Here we reanalyze the resource selection function fitted to reindeer
movement data from the Hardangervidda wild reindeer population, used in
Niebuhr et al. 2023 to estimate the zone of influence (ZOI) and the
cumulative impacts of tourism infrastructure on reindeer habitat
selection during summer.</p>
<p>The data comprises GPS positions from 115 female reindeer, recorded
with a 3h fix rate. The data was put into a use-availabililty design,
with 1 used location for each 9 random locations distributed over the
limits of the wild reindeer area. The data was intersected with
environmental variables on land cover, four PCAs representing
bio-geo-climatic variation, and (<strong>the ZOI of the nearest
infrastructure and</strong> <strong>remove from this tutorial</strong>)
the cumulative ZOI of infrastructure types. The infrastructures
considered were private cottages and public tourist resorts. More
information about the cumulative ZOI approach, the data collection, and
the data preparation for analysis might be found in Niebuhr et
al. 2023.</p>
<div class="float">
<img src="reindeer_gps_points_hardanger_summer.png" alt="GPS data from wild reindeer in summer in the Hardangervidda wild reindeer population in southern Norway; figure from Niebuhr et al. 2023."><div class="figcaption">GPS data from wild reindeer in summer in the
Hardangervidda wild reindeer population in southern Norway; figure from
Niebuhr et al. 2023.</div>
</div>
<p>Here we show the workflow for preparing the data, fitting a
conditional logistic regression model to it, and checking model fits
combining bootstrap aggregation (bagging) and penalized regression. In a
bootstrap aggregation setup, the model is repeatedly fitted to a subset
of the full data set and model fits are aggregated into a bag (a group
of models). Each model model is based on a different sub-set (a
resample) of the full data set, allowing variation among them and the
estimation of uncertainty on the model parameters. The penalized
regression approach allows us to perform model fitting and variable
selection within the same procedure. For each resample the data is split
into a fitting/train set, used to fit the individual model with multiple
possible penalty parameters, and a tuning/test set, used to calibrate
the model, i.e. to select the most parsimonious penalty parameter, used
then to determine the best fitted model.</p>
<p>Penalized regression might be fitted using different approaches, such
as Ridge, Lasso, and Adaptive Lasso. Ridge regression shrinks the
parameters toward zero, but still keep all of them in the final fitted
model. Lasso (and Adaptive Lasso) allow for variable selection as well,
potentially removing unimportant variables from the fitted model.
Adaptive Lasso allows for different coefficients being penalized
differently and is therefore more flexible than Ridge and Lasso. The
<code>oneimpact</code> package offers different “flavors” of Adaptive
Lasso, by allowing different ways to set the prior penalties to the
different ZOI and non-ZOI variables. For the purpose of this vignette,
we exemplify the approach through Adaptive Lasso regression.</p>
</div>
<div class="section level2">
<h2 id="preparing-the-data-and-the-model">Preparing the data and the model<a class="anchor" aria-label="anchor" href="#preparing-the-data-and-the-model"></a>
</h2>
<p>We start by loading the packages and the annotated data, already
prepared for analysis. For details on the preparation of biological and
environmental/zone of influence data and data annotation workflow,
please check Niebuhr et al. 2023.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://glmnet.stanford.edu" class="external-link">glmnet</a></span><span class="op">)</span> <span class="co"># for fitting</span></span></code></pre></div>
<pre><code><span><span class="co">## Loading required package: Matrix</span></span></code></pre>
<pre><code><span><span class="co">## Loaded glmnet 4.1-9</span></span></code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span> <span class="co"># for plotting</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-tmap/tmap" class="external-link">tmap</a></span><span class="op">)</span> <span class="co"># for plotting maps</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span> <span class="co"># for spatial predictions</span></span></code></pre></div>
<pre><code><span><span class="co">## terra 1.8.54</span></span></code></pre>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/NINAnor/oneimpact" class="external-link">oneimpact</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'oneimpact'</span></span></code></pre>
<pre><code><span><span class="co">## The following object is masked from 'package:terra':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     predict</span></span></code></pre>
<pre><code><span><span class="co">## The following objects are masked from 'package:glmnet':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     Cindex, coxnet.deviance</span></span></code></pre>
<pre><code><span><span class="co">## The following object is masked from 'package:stats':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     predict</span></span></code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"reindeer_rsf"</span><span class="op">)</span></span>
<span><span class="co"># rename it just for convenience</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">reindeer_rsf</span></span>
<span></span>
<span><span class="co"># explore columns</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "use"                                         </span></span>
<span><span class="co">##  [2] "norway_pca_klima_axis1"                      </span></span>
<span><span class="co">##  [3] "norway_pca_klima_axis2"                      </span></span>
<span><span class="co">##  [4] "norway_pca_klima_axis3"                      </span></span>
<span><span class="co">##  [5] "norway_pca_klima_axis4"                      </span></span>
<span><span class="co">##  [6] "norway_pca_klima_axis1_sq"                   </span></span>
<span><span class="co">##  [7] "norway_pca_klima_axis2_sq"                   </span></span>
<span><span class="co">##  [8] "NORUTreclass"                                </span></span>
<span><span class="co">##  [9] "private_cabins_cumulative_exp_decay100"      </span></span>
<span><span class="co">## [10] "private_cabins_cumulative_exp_decay250"      </span></span>
<span><span class="co">## [11] "private_cabins_cumulative_exp_decay500"      </span></span>
<span><span class="co">## [12] "private_cabins_cumulative_exp_decay1000"     </span></span>
<span><span class="co">## [13] "private_cabins_cumulative_exp_decay2500"     </span></span>
<span><span class="co">## [14] "private_cabins_cumulative_exp_decay5000"     </span></span>
<span><span class="co">## [15] "private_cabins_cumulative_exp_decay10000"    </span></span>
<span><span class="co">## [16] "private_cabins_cumulative_exp_decay20000"    </span></span>
<span><span class="co">## [17] "private_cabins_nearest_exp_decay100"         </span></span>
<span><span class="co">## [18] "private_cabins_nearest_exp_decay250"         </span></span>
<span><span class="co">## [19] "private_cabins_nearest_exp_decay500"         </span></span>
<span><span class="co">## [20] "private_cabins_nearest_exp_decay1000"        </span></span>
<span><span class="co">## [21] "private_cabins_nearest_exp_decay2500"        </span></span>
<span><span class="co">## [22] "private_cabins_nearest_exp_decay5000"        </span></span>
<span><span class="co">## [23] "private_cabins_nearest_exp_decay10000"       </span></span>
<span><span class="co">## [24] "private_cabins_nearest_exp_decay20000"       </span></span>
<span><span class="co">## [25] "public_cabins_high_cumulative_exp_decay100"  </span></span>
<span><span class="co">## [26] "public_cabins_high_cumulative_exp_decay250"  </span></span>
<span><span class="co">## [27] "public_cabins_high_cumulative_exp_decay500"  </span></span>
<span><span class="co">## [28] "public_cabins_high_cumulative_exp_decay1000" </span></span>
<span><span class="co">## [29] "public_cabins_high_cumulative_exp_decay2500" </span></span>
<span><span class="co">## [30] "public_cabins_high_cumulative_exp_decay5000" </span></span>
<span><span class="co">## [31] "public_cabins_high_cumulative_exp_decay10000"</span></span>
<span><span class="co">## [32] "public_cabins_high_cumulative_exp_decay20000"</span></span>
<span><span class="co">## [33] "public_cabins_high_nearest_exp_decay100"     </span></span>
<span><span class="co">## [34] "public_cabins_high_nearest_exp_decay250"     </span></span>
<span><span class="co">## [35] "public_cabins_high_nearest_exp_decay500"     </span></span>
<span><span class="co">## [36] "public_cabins_high_nearest_exp_decay1000"    </span></span>
<span><span class="co">## [37] "public_cabins_high_nearest_exp_decay2500"    </span></span>
<span><span class="co">## [38] "public_cabins_high_nearest_exp_decay5000"    </span></span>
<span><span class="co">## [39] "public_cabins_high_nearest_exp_decay10000"   </span></span>
<span><span class="co">## [40] "public_cabins_high_nearest_exp_decay20000"   </span></span>
<span><span class="co">## [41] "roads_low_cumulative_exp_decay100"           </span></span>
<span><span class="co">## [42] "roads_low_cumulative_exp_decay250"           </span></span>
<span><span class="co">## [43] "roads_low_cumulative_exp_decay500"           </span></span>
<span><span class="co">## [44] "roads_low_cumulative_exp_decay1000"          </span></span>
<span><span class="co">## [45] "roads_low_cumulative_exp_decay2500"          </span></span>
<span><span class="co">## [46] "roads_low_cumulative_exp_decay5000"          </span></span>
<span><span class="co">## [47] "roads_low_cumulative_exp_decay10000"         </span></span>
<span><span class="co">## [48] "roads_low_cumulative_exp_decay20000"         </span></span>
<span><span class="co">## [49] "roads_low_nearest_exp_decay100"              </span></span>
<span><span class="co">## [50] "roads_low_nearest_exp_decay250"              </span></span>
<span><span class="co">## [51] "roads_low_nearest_exp_decay500"              </span></span>
<span><span class="co">## [52] "roads_low_nearest_exp_decay1000"             </span></span>
<span><span class="co">## [53] "roads_low_nearest_exp_decay2500"             </span></span>
<span><span class="co">## [54] "roads_low_nearest_exp_decay5000"             </span></span>
<span><span class="co">## [55] "roads_low_nearest_exp_decay10000"            </span></span>
<span><span class="co">## [56] "roads_low_nearest_exp_decay20000"            </span></span>
<span><span class="co">## [57] "roads_high_cumulative_exp_decay100"          </span></span>
<span><span class="co">## [58] "roads_high_cumulative_exp_decay250"          </span></span>
<span><span class="co">## [59] "roads_high_cumulative_exp_decay500"          </span></span>
<span><span class="co">## [60] "roads_high_cumulative_exp_decay1000"         </span></span>
<span><span class="co">## [61] "roads_high_cumulative_exp_decay2500"         </span></span>
<span><span class="co">## [62] "roads_high_cumulative_exp_decay5000"         </span></span>
<span><span class="co">## [63] "roads_high_cumulative_exp_decay10000"        </span></span>
<span><span class="co">## [64] "roads_high_cumulative_exp_decay20000"        </span></span>
<span><span class="co">## [65] "roads_high_nearest_exp_decay100"             </span></span>
<span><span class="co">## [66] "roads_high_nearest_exp_decay250"             </span></span>
<span><span class="co">## [67] "roads_high_nearest_exp_decay500"             </span></span>
<span><span class="co">## [68] "roads_high_nearest_exp_decay1000"            </span></span>
<span><span class="co">## [69] "roads_high_nearest_exp_decay2500"            </span></span>
<span><span class="co">## [70] "roads_high_nearest_exp_decay5000"            </span></span>
<span><span class="co">## [71] "roads_high_nearest_exp_decay10000"           </span></span>
<span><span class="co">## [72] "roads_high_nearest_exp_decay20000"           </span></span>
<span><span class="co">## [73] "trails_cumulative_exp_decay100"              </span></span>
<span><span class="co">## [74] "trails_cumulative_exp_decay250"              </span></span>
<span><span class="co">## [75] "trails_cumulative_exp_decay500"              </span></span>
<span><span class="co">## [76] "trails_cumulative_exp_decay1000"             </span></span>
<span><span class="co">## [77] "trails_cumulative_exp_decay2500"             </span></span>
<span><span class="co">## [78] "trails_cumulative_exp_decay5000"             </span></span>
<span><span class="co">## [79] "trails_cumulative_exp_decay10000"            </span></span>
<span><span class="co">## [80] "trails_cumulative_exp_decay20000"            </span></span>
<span><span class="co">## [81] "trails_nearest_exp_decay100"                 </span></span>
<span><span class="co">## [82] "trails_nearest_exp_decay250"                 </span></span>
<span><span class="co">## [83] "trails_nearest_exp_decay500"                 </span></span>
<span><span class="co">## [84] "trails_nearest_exp_decay1000"                </span></span>
<span><span class="co">## [85] "trails_nearest_exp_decay2500"                </span></span>
<span><span class="co">## [86] "trails_nearest_exp_decay5000"                </span></span>
<span><span class="co">## [87] "trails_nearest_exp_decay10000"               </span></span>
<span><span class="co">## [88] "trails_nearest_exp_decay20000"</span></span></code></pre>
<p>The data set “reindeer_rsf” in the <code>oneimpact</code> package
contains the wild reindeer data used to fit the resource selection
functions using the cumulative ZOI approach in Niebuhr et al. 2023. The
response variable <code>use</code> is a binary variable showing whether
a given location was used (1) or not (0, a random location within the
population area). The used and available positions were annotated with
information on land cover (column <code>NORUTreclass</code>),
bio-geo-climatic PCAs (columns <code>norway_pca_klima_axis</code> 1 to
4) and the zone of influence of private cottages and public resorts
(columns starting with <code>private_cabins</code> and
<code>public_cabins_high</code>, respectively). Zone of influence
variables include both the ZOI of the nearest feature and the cumulative
ZOI, with radii from 100 m to 20 km. For illustration, we only kept ZOI
variables with exponential decay shape and cumulative type (not
nearest).</p>
<p>The predictor variables are not standardized, but it is essential to
standardize them for penalized regression. The standardization can be
done in advance or directly within the model fitting procedure (as we do
it here).</p>
<div class="section level3">
<h3 id="model-specification">Model specification<a class="anchor" aria-label="anchor" href="#model-specification"></a>
</h3>
<p>We start by defining the structure of the model to be fitted - the
<code>formula</code>, in R terminology. To do that, we make use of the
function <code><a href="../reference/add_zoi_formula.html">oneimpact::add_zoi_formula()</a></code> to make it easier to
add the ZOI metrics with multiple radii in the formula.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># formula initial structure</span></span>
<span><span class="va">f</span> <span class="op">&lt;-</span> <span class="va">use</span> <span class="op">~</span> <span class="va">private_cabins_XXX</span> <span class="op">+</span> <span class="va">public_cabins_high_XXX</span> <span class="op">+</span></span>
<span>  <span class="va">NORUTreclass</span> <span class="op">+</span></span>
<span>  <span class="co"># poly(norway_pca_klima_axis1, 2, raw = TRUE) + </span></span>
<span>  <span class="co"># poly(norway_pca_klima_axis2, 2, raw = TRUE) +</span></span>
<span>  <span class="va">norway_pca_klima_axis1</span> <span class="op">+</span> <span class="va">norway_pca_klima_axis1_sq</span> <span class="op">+</span></span>
<span>  <span class="va">norway_pca_klima_axis2</span> <span class="op">+</span> <span class="va">norway_pca_klima_axis2_sq</span> <span class="op">+</span></span>
<span>  <span class="va">norway_pca_klima_axis3</span> <span class="op">+</span> <span class="va">norway_pca_klima_axis4</span></span>
<span></span>
<span><span class="co"># add ZOI terms to the formula</span></span>
<span><span class="va">zois</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">250</span>, <span class="fl">500</span>, <span class="fl">1000</span>, <span class="fl">2500</span>, <span class="fl">5000</span>, <span class="fl">10000</span>, <span class="fl">20000</span><span class="op">)</span></span>
<span><span class="va">ff</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_zoi_formula.html">add_zoi_formula</a></span><span class="op">(</span><span class="va">f</span>, zoi_radius <span class="op">=</span> <span class="va">zois</span>, pattern <span class="op">=</span> <span class="st">"XXX"</span>, </span>
<span>                      type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cumulative_exp_decay"</span><span class="op">)</span>,</span>
<span>                      separator <span class="op">=</span> <span class="st">""</span>, predictor_table <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># get formula</span></span>
<span><span class="va">f</span> <span class="op">&lt;-</span> <span class="va">ff</span><span class="op">$</span><span class="va">formula</span></span>
<span><span class="co"># predictor_table for usage later to map ZOI-like type variables</span></span>
<span><span class="va">predictor_table_zoi</span> <span class="op">&lt;-</span> <span class="va">ff</span><span class="op">$</span><span class="va">predictor_table</span></span></code></pre></div>
<p>Contrary to the traditional sub-set modeling approaches, in which
only one ZOI predictor with a specific radius is kept in the model at a
time and multiple models are fitted and compared, here we keep all the
terms in the formula and use a penalized regression approach to both fit
the model and select the variables.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f</span></span></code></pre></div>
<pre><code><span><span class="co">## use ~ private_cabins_cumulative_exp_decay100 + private_cabins_cumulative_exp_decay250 + </span></span>
<span><span class="co">##     private_cabins_cumulative_exp_decay500 + private_cabins_cumulative_exp_decay1000 + </span></span>
<span><span class="co">##     private_cabins_cumulative_exp_decay2500 + private_cabins_cumulative_exp_decay5000 + </span></span>
<span><span class="co">##     private_cabins_cumulative_exp_decay10000 + private_cabins_cumulative_exp_decay20000 + </span></span>
<span><span class="co">##     public_cabins_high_cumulative_exp_decay100 + public_cabins_high_cumulative_exp_decay250 + </span></span>
<span><span class="co">##     public_cabins_high_cumulative_exp_decay500 + public_cabins_high_cumulative_exp_decay1000 + </span></span>
<span><span class="co">##     public_cabins_high_cumulative_exp_decay2500 + public_cabins_high_cumulative_exp_decay5000 + </span></span>
<span><span class="co">##     public_cabins_high_cumulative_exp_decay10000 + public_cabins_high_cumulative_exp_decay20000 + </span></span>
<span><span class="co">##     NORUTreclass + norway_pca_klima_axis1 + norway_pca_klima_axis1_sq + </span></span>
<span><span class="co">##     norway_pca_klima_axis2 + norway_pca_klima_axis2_sq + norway_pca_klima_axis3 + </span></span>
<span><span class="co">##     norway_pca_klima_axis4</span></span>
<span><span class="co">## &lt;environment: 0x55dae10cdfe8&gt;</span></span></code></pre>
<p>The <code><a href="../reference/add_zoi_formula.html">add_zoi_formula()</a></code> function can also produce a
<code>predictor_table</code> <code>data.frame</code>, which specifies
characteristics of the covariates in the model - e.g. whether they are
ZOI metrics or not, which type (cumulative, nearest), and which radii.
This is helpful to treat the ZOI variables differently in the model
interpretation, to aggregate ZOI terms related to the same type of
infrastructure, and also to define the term penalties in the different
flavors of “Adaptive Lasso” approaches.</p>
<p>Here we take a glance on the structure of this table:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">predictor_table_zoi</span>, <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    is_zoi cumulative     shape zoi_radius            variable</span></span>
<span><span class="co">## 1       1 cumulative exp_decay        100     private_cabins_</span></span>
<span><span class="co">## 2       1 cumulative exp_decay        250     private_cabins_</span></span>
<span><span class="co">## 3       1 cumulative exp_decay        500     private_cabins_</span></span>
<span><span class="co">## 4       1 cumulative exp_decay       1000     private_cabins_</span></span>
<span><span class="co">## 5       1 cumulative exp_decay       2500     private_cabins_</span></span>
<span><span class="co">## 6       1 cumulative exp_decay       5000     private_cabins_</span></span>
<span><span class="co">## 7       1 cumulative exp_decay      10000     private_cabins_</span></span>
<span><span class="co">## 8       1 cumulative exp_decay      20000     private_cabins_</span></span>
<span><span class="co">## 9       1 cumulative exp_decay        100 public_cabins_high_</span></span>
<span><span class="co">## 10      1 cumulative exp_decay        250 public_cabins_high_</span></span>
<span><span class="co">##                                      term_zoi</span></span>
<span><span class="co">## 1      private_cabins_cumulative_exp_decay100</span></span>
<span><span class="co">## 2      private_cabins_cumulative_exp_decay250</span></span>
<span><span class="co">## 3      private_cabins_cumulative_exp_decay500</span></span>
<span><span class="co">## 4     private_cabins_cumulative_exp_decay1000</span></span>
<span><span class="co">## 5     private_cabins_cumulative_exp_decay2500</span></span>
<span><span class="co">## 6     private_cabins_cumulative_exp_decay5000</span></span>
<span><span class="co">## 7    private_cabins_cumulative_exp_decay10000</span></span>
<span><span class="co">## 8    private_cabins_cumulative_exp_decay20000</span></span>
<span><span class="co">## 9  public_cabins_high_cumulative_exp_decay100</span></span>
<span><span class="co">## 10 public_cabins_high_cumulative_exp_decay250</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="setting-samples">Setting samples<a class="anchor" aria-label="anchor" href="#setting-samples"></a>
</h3>
<p>As in several machine learning workflows, we partition the data into
sets used to fit (or train) the model, calibrate (or tune/test), and
validate. Here this is done within a bootstrap aggregation (bagging)
procedure, so in general only part of the data is used at a time. We use
the function <code><a href="../reference/create_resamples.html">oneimpact::create_resamples()</a></code> for this
purpose, where we define the number of times we’ll resample (i.e., the
size of the bag, parameter <code>times</code>) and the proportion of the
data observations that goes into fitting, calibration, and validation
(parameter <code>p</code>) in each resample. For simplicity, we perform
random sampling here, but the sampling can also be spatially
stratified.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># sampling - random sampling</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span>
<span><span class="va">samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_resamples.html">create_resamples</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">dat</span><span class="op">$</span><span class="va">use</span>,</span>
<span>                            p <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.2</span>, <span class="fl">0.2</span><span class="op">)</span>,</span>
<span>                            times <span class="op">=</span> <span class="fl">50</span>,</span>
<span>                            colH0 <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Starting random sampling..."</span></span></code></pre>
<p>When there is no spatial stratification, the object
<code>samples</code> is a list of three elements: a list of sets
(defined by the row numbers in the original data set) that will be used
for (i) model fitting (<code>samples$train</code>), for (ii) variable
selection/calibration (<code>samples$test</code>), and for (iii) model
validation (<code>samples$validate</code>).</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">samples</span>, max.level <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## List of 3</span></span>
<span><span class="co">##  $ train   :List of 50</span></span>
<span><span class="co">##  $ test    :List of 50</span></span>
<span><span class="co">##  $ validate:List of 50</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="fitting-the-model">Fitting the model<a class="anchor" aria-label="anchor" href="#fitting-the-model"></a>
</h2>
<p>To fit one single model (e.g. the one corresponding to the first
resample above) using logistic penalized regression, we can use the
function <code><a href="../reference/fit_net_functions.html">oneimpact::fit_net_logit()</a></code> which calls
<code><a href="https://glmnet.stanford.edu/reference/glmnet.html" class="external-link">glmnet::glmnet()</a></code> for the fitting procedure. We give an
example below. By default, a Lasso fit is performed, but the
<code>method</code> parameter might be used to change it for a Ridge or
Adaptive Lasso regression. Notice that observations with missing values
in the data resamples need to be removed before fitting, so the actual
number of observations used for fitting, calibration, and validation
might be actually smaller than it was set. A warning message is printed
in these cases; but we recommend that missing data is checked in
advance.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># dat2 &lt;- dat</span></span>
<span><span class="co"># dat$public_cabins_high_cumulative_exp_decay_1000 &lt;- 0</span></span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_net_functions.html">fit_net_logit</a></span><span class="op">(</span><span class="va">f</span>, </span>
<span>                     data <span class="op">=</span> <span class="va">dat</span>,</span>
<span>                     samples <span class="op">=</span> <span class="va">samples</span>, </span>
<span>                     i <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                     metric <span class="op">=</span> <span class="st">"AUC"</span>,</span>
<span>                     method <span class="op">=</span> <span class="st">"Lasso"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in fit_net_logit(f, data = dat, samples = samples, i = 1, metric =</span></span>
<span><span class="co">## "AUC", : 100 missing observations were removed from the train set. 14767</span></span>
<span><span class="co">## observations were kept.</span></span></code></pre>
<pre><code><span><span class="co">## Warning in fit_net_logit(f, data = dat, samples = samples, i = 1, metric =</span></span>
<span><span class="co">## "AUC", : 69 missing observations were removed from the test set. 14798</span></span>
<span><span class="co">## observations were kept.</span></span></code></pre>
<pre><code><span><span class="co">## Warning in fit_net_logit(f, data = dat, samples = samples, i = 1, metric =</span></span>
<span><span class="co">## "AUC", : 108 missing observations were removed from the validate set. 14759</span></span>
<span><span class="co">## observations were kept.</span></span></code></pre>
<p>We will just examine the structure of the output object now. It
comprises a list with:</p>
<ul>
<li>
<code>parms</code>: The initial parameters used for when calling
<code><a href="../reference/fit_net_functions.html">fit_net_logit()</a></code>;</li>
<li>
<code>glmnet_fit</code>: The actual output from <code>glmnet</code>,
a set of models with different penalty parameters;</li>
<li>
<code>metrics_evaluated</code>: The names of the metrics evaluated
for setting the penalty parameter <code>lambda</code>, set by the
<code>metrics_evaluated</code> argument when calling
<code><a href="../reference/fit_net_functions.html">fit_net_logit()</a></code>; by default the only one is
<code>"AUC"</code>;</li>
<li>
<code>var_names</code>: The names of the variables included in the
model formula;</li>
<li>
<code>numeric_covs</code>: A vector of logical values for whether
each of the covariates is numeric or not;</li>
<li>
<code>covariate_mean_sd</code>: A matrix with the mean and standard
deviation for each of the covariates in the model, useful for
standardizing or unstandardizing covariates and coefficients;</li>
<li>
<code>metric</code>: The name of the metric selected for model
validation, here <code>"AUC"</code>;</li>
<li>
<code>lambda</code>: The final penalty parameter <code>lambda</code>
selected for the best fitted model;</li>
<li>
<code>coef</code>: The coefficients for the variables in the fitted
model;</li>
<li>
<code>train_score</code>: The score of the model (i.e., the result
of the <code>metric</code> when applied to) for the train/fitting
set;</li>
<li>
<code>train_score</code>: The score of the model (i.e., the result
of the <code>metric</code> when applied to) for the test/calibration
set;</li>
<li>
<code>validation_score</code>: The score of the model (i.e., the
result of the <code>metric</code> when applied to) for the validation
set. If there is a hierarchical block H0 for block cross validation
(e.g.  representing the populations, study areas, or years; see
parameter <code>H0</code> in the functions <code><a href="../reference/spat_strat.html">spat_strat()</a></code> and
<code><a href="../reference/create_resamples.html">create_resamples()</a></code>), this is computed for each block
H0;</li>
<li>
<code>validation_score_avg</code>: Average of the validation scores
across block H0, when they are present.</li>
<li>
<code>lambdas</code>: The different penalty parameters selected for
each of the <code>metrics_evaluated</code>, when there is more than one
metric;</li>
<li>
<code>coefs_all</code>, <code>train_score_all</code>,
<code>test_score_all</code>, <code>validation_score_all</code>: The same
as <code>coef</code>, <code>train_score</code>, <code>test_score</code>,
and <code>validation_score</code>, but for all the
<code>metrics_evaluated</code>, when there is more than one metric.</li>
</ul>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">mod</span>, max.level <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## List of 20</span></span>
<span><span class="co">##  $ parms               :List of 16</span></span>
<span><span class="co">##  $ glmnet_fit          :List of 13</span></span>
<span><span class="co">##   ..- attr(*, "class")= chr [1:2] "lognet" "glmnet"</span></span>
<span><span class="co">##  $ metrics_evaluated   :List of 1</span></span>
<span><span class="co">##  $ var_names           : chr [1:36] "private_cabins_cumulative_exp_decay100" "private_cabins_cumulative_exp_decay250" "private_cabins_cumulative_exp_decay500" "private_cabins_cumulative_exp_decay1000" ...</span></span>
<span><span class="co">##  $ numeric_covs        : Named logi [1:23] TRUE TRUE TRUE TRUE TRUE TRUE ...</span></span>
<span><span class="co">##   ..- attr(*, "names")= chr [1:23] "private_cabins_cumulative_exp_decay100" "private_cabins_cumulative_exp_decay250" "private_cabins_cumulative_exp_decay500" "private_cabins_cumulative_exp_decay1000" ...</span></span>
<span><span class="co">##  $ covariate_mean_sd   :'data.frame':    22 obs. of  2 variables:</span></span>
<span><span class="co">##  $ metric              : chr "AUC"</span></span>
<span><span class="co">##  $ alpha               : num 1</span></span>
<span><span class="co">##  $ lambda              : num 0.00123</span></span>
<span><span class="co">##  $ coef                : num [1:36, 1] 0 0 0 0 0 ...</span></span>
<span><span class="co">##   ..- attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">##  $ train_score         : num 0.915</span></span>
<span><span class="co">##  $ test_score          : num 0.926</span></span>
<span><span class="co">##  $ validation_score    : num 0.913</span></span>
<span><span class="co">##  $ validation_score_avg: num 0.913</span></span>
<span><span class="co">##  $ lambdas             : Named num 0.00123</span></span>
<span><span class="co">##   ..- attr(*, "names")= chr "AUC"</span></span>
<span><span class="co">##  $ coefs_all           : num [1:36, 1] 0 0 0 0 0 ...</span></span>
<span><span class="co">##   ..- attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">##  $ coefs_std_all       :List of 1</span></span>
<span><span class="co">##  $ train_score_all     : Named num 0.915</span></span>
<span><span class="co">##   ..- attr(*, "names")= chr "AUC"</span></span>
<span><span class="co">##  $ test_score_all      : Named num 0.926</span></span>
<span><span class="co">##   ..- attr(*, "names")= chr "AUC"</span></span>
<span><span class="co">##  $ validation_score_all: Named num 0.913</span></span>
<span><span class="co">##   ..- attr(*, "names")= chr "AUC"</span></span></code></pre>
<p>Here the model was calibrated and evaluated using the Area Under the
ROC curve, AUC.</p>
<p>However, in this approach we are interested not only in one single
model, but in bootstrapping from the whole data set and producing a bag
of models. In this case, we can use the function
<code><a href="../reference/bag_fit_net_functions.html">oneimpact::bag_fit_net_logit()</a></code> which fits all the models
and produces a list with all the outputs. After fitting, the function
<code><a href="../reference/bag_models.html">oneimpact::bag_models()</a></code> can be used to organize the output
of each model in a single “bag” object, of the class
<code>bag</code>.</p>
<p>Running the bag of models below can take some minutes, and the
running time can be high for larger data sets and more complex models.
The model fitting can be done in parallel, and also saved in external
files if needed.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># fit multiple models</span></span>
<span><span class="va">fittedl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bag_fit_net_functions.html">bag_fit_net_logit</a></span><span class="op">(</span><span class="va">f</span>, <span class="va">dat</span>,</span>
<span>                             samples <span class="op">=</span> <span class="va">samples</span>,</span>
<span>                             standardize <span class="op">=</span> <span class="st">"internal"</span>, <span class="co"># glmnet does the standardization of covariates</span></span>
<span>                             metric <span class="op">=</span> <span class="st">"AUC"</span>,</span>
<span>                             method <span class="op">=</span> <span class="st">"Lasso"</span>,</span>
<span>                             parallel <span class="op">=</span> <span class="st">"mclapply"</span>,</span>
<span>                             mc.cores <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># bag models in a single object</span></span>
<span><span class="va">bag_object</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bag_models.html">bag_models</a></span><span class="op">(</span><span class="va">fittedl</span>, <span class="va">dat</span>, score_threshold <span class="op">=</span> <span class="fl">0.7</span>, </span>
<span>                          weights_function <span class="op">=</span> <span class="va">w_strech_max_squared</span><span class="op">)</span></span></code></pre></div>
<p>The resulting bag of models is a list which includes the number of
models fitted <code>n</code>, the original formula fitted
(<code>formula</code>), the fitting method (<code>method</code>) and
validation metric (<code>metric</code>), a matrix of coefficients
(<code>coef</code>) and the fitting, calibration, and validation scores
(<code>validation_score</code>) for all models.</p>
<p>The function <code><a href="../reference/bag_models.html">bag_models()</a></code> also transforms the validation
scores into weights, so that the coefficients of each model might be
weighted according to how well they fit the data. Models with a
validation score below a certain threshold (parameter
<code>score_threshold</code>) are set to weight zero and ignored in the
final bag; the other models’ weights are transformed and normalized (to
sum 1) according to any standard or user-defined function (set by the
parameter <code>weights_function</code>). As a consequence, a number of
objects related to the weights and the weighted validation scores is
also present in the bag object, as well as summaries of the data that
are useful for model prediction.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">bag_object</span>, max.level <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## List of 32</span></span>
<span><span class="co">##  $ n                                : int 50</span></span>
<span><span class="co">##  $ formula                          :Class 'formula'  language use ~ private_cabins_cumulative_exp_decay100 + private_cabins_cumulative_exp_decay250 +      private_cabins_cumul| __truncated__ ...</span></span>
<span><span class="co">##   .. ..- attr(*, ".Environment")=&lt;environment: 0x55dae10cdfe8&gt; </span></span>
<span><span class="co">##  $ formula_no_strata                :Class 'formula'  language use ~ -1 + private_cabins_cumulative_exp_decay100 + private_cabins_cumulative_exp_decay250 +      private_cabins_| __truncated__ ...</span></span>
<span><span class="co">##   .. ..- attr(*, ".Environment")=&lt;environment: 0x55dae14e5ac8&gt; </span></span>
<span><span class="co">##  $ method                           : chr "Lasso"</span></span>
<span><span class="co">##  $ metric                           : chr "AUC"</span></span>
<span><span class="co">##  $ metrics_evaluated                : Named chr "AUC"</span></span>
<span><span class="co">##   ..- attr(*, "names")= chr "AUC"</span></span>
<span><span class="co">##  $ samples                          :List of 3</span></span>
<span><span class="co">##  $ standardize                      : chr "internal"</span></span>
<span><span class="co">##  $ errors                           : Named logi [1:50] FALSE FALSE FALSE FALSE FALSE FALSE ...</span></span>
<span><span class="co">##   ..- attr(*, "names")= chr [1:50] "Resample01" "Resample02" "Resample03" "Resample04" ...</span></span>
<span><span class="co">##  $ error_message                    : logi [1:50] NA NA NA NA NA NA ...</span></span>
<span><span class="co">##  $ n_errors                         : int 0</span></span>
<span><span class="co">##  $ n_no_errors                      : int 50</span></span>
<span><span class="co">##  $ parms                            :List of 11</span></span>
<span><span class="co">##  $ alpha                            : num 1</span></span>
<span><span class="co">##  $ var_names                        : chr [1:36] "private_cabins_cumulative_exp_decay100" "private_cabins_cumulative_exp_decay250" "private_cabins_cumulative_exp_decay500" "private_cabins_cumulative_exp_decay1000" ...</span></span>
<span><span class="co">##  $ lambda                           : num [1, 1:50] 1.23e-03 8.70e-06 1.98e-04 8.52e-06 8.76e-06 ...</span></span>
<span><span class="co">##   ..- attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">##  $ weight_ref                       : chr "validation_score"</span></span>
<span><span class="co">##  $ weight_threshold                 : num 0.7</span></span>
<span><span class="co">##  $ weights                          : Named num [1:50] 0.0197 0.02 0.02 0.0201 0.02 ...</span></span>
<span><span class="co">##   ..- attr(*, "names")= chr [1:50] "Resample01" "Resample02" "Resample03" "Resample04" ...</span></span>
<span><span class="co">##  $ n_above_threshold                : int 50</span></span>
<span><span class="co">##  $ coef                             : num [1:36, 1:50] 0 0 0 0 0 ...</span></span>
<span><span class="co">##   ..- attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">##  $ wcoef                            : num [1:36, 1:50] 0 0 0 0 0 ...</span></span>
<span><span class="co">##   ..- attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">##  $ wcoef_std                        : num(0) </span></span>
<span><span class="co">##  $ fit_score                        : num [1, 1:50] 0.915 0.921 0.921 0.918 0.923 ...</span></span>
<span><span class="co">##   ..- attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">##  $ calibration_score                : num [1, 1:50] 0.926 0.919 0.915 0.917 0.914 ...</span></span>
<span><span class="co">##   ..- attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">##  $ validation_score                 : num [1, 1:50] 0.913 0.92 0.919 0.921 0.92 ...</span></span>
<span><span class="co">##   ..- attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">##  $ validation_score_summary         :'data.frame':   50 obs. of  1 variable:</span></span>
<span><span class="co">##  $ weighted_validation_score        : num [1, 1] 0.919</span></span>
<span><span class="co">##   ..- attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">##  $ weighted_validation_score_summary: num [1, 1] 0.919</span></span>
<span><span class="co">##   ..- attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">##  $ covariate_mean_sd                :'data.frame':   22 obs. of  2 variables:</span></span>
<span><span class="co">##  $ data_summary                     :'data.frame':   11 obs. of  24 variables:</span></span>
<span><span class="co">##  $ numeric_covs                     : Named logi [1:23] TRUE TRUE TRUE TRUE TRUE TRUE ...</span></span>
<span><span class="co">##   ..- attr(*, "names")= chr [1:23] "private_cabins_cumulative_exp_decay100" "private_cabins_cumulative_exp_decay250" "private_cabins_cumulative_exp_decay500" "private_cabins_cumulative_exp_decay1000" ...</span></span>
<span><span class="co">##  - attr(*, "class")= chr [1:2] "bag" "list"</span></span></code></pre>
<p>Here we have two sets of functions important for defining the bag of
models. The first function (defined by the parameter
<code>score2weight</code>) defines how validation scores are transformed
into weights (e.g. mean of scores for <code>score2weight_mean</code> and
<code>score2weight_min_mean</code>) and also which criterion is used to
set weights to zero (e.g. models with average score below the threshold
are set to weight 0 for <code>score2weight_mean</code>, but models with
minimum score below the threshold are set to weight zero for
<code>score2weight_min_mean</code>).</p>
<p>The second function is defined by the parameter
<code>weights_function</code> and defines how the weights &gt; 0 are
normalized and stretched to sum 1.</p>
</div>
<div class="section level2">
<h2 id="interpreting-the-model">Interpreting the model<a class="anchor" aria-label="anchor" href="#interpreting-the-model"></a>
</h2>
<p>Once the model was fit, a number of diagnostics and plots can be used
to understand the model fit.</p>
<div class="section level3">
<h3 id="model-validation">Model validation<a class="anchor" aria-label="anchor" href="#model-validation"></a>
</h3>
<p>First, it is possible to check and plot the validation scores to know
how well the model performs under new conditions.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bag_object</span><span class="op">$</span><span class="va">validation_score</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] 0.9131054 0.9203894 0.9194246 0.9212400 0.9200966 0.9183340 0.9151591</span></span>
<span><span class="co">##  [8] 0.9181758 0.9194765 0.9190469</span></span></code></pre>
<p>In this example, all the models of the bag have a quite good (and
equivalent) performance, with an average weighted validation AUC of `r
round(bag_object$weighted_validation_score[1], 3). Here we go beyond
just averaging the scores, but we also account for the weights of each
model, with more weight for models better ranked. We can also plot the
scores for each model in the bag:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">bag_object</span><span class="op">$</span><span class="va">validation_score</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Validation score"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="fl">0.7</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="co"># threshold</span></span></code></pre></div>
<div class="figure">
<img src="fitting_ZOI_logit_files/figure-html/unnamed-chunk-1-1.png" alt="Histogram of validation scores for the bag of fitted models. The red line shows the threshold for excluding low scoring models. In this example, all models performed well and were kept in the bag." width="700"><p class="caption">
Histogram of validation scores for the bag of fitted models. The red
line shows the threshold for excluding low scoring models. In this
example, all models performed well and were kept in the bag.
</p>
</div>
</div>
<div class="section level3">
<h3 id="variable-importance">Variable importance<a class="anchor" aria-label="anchor" href="#variable-importance"></a>
</h3>
<p>Variable importance helps us understand the effect size of the
different covariates included in the model by evaluating how strongly
one or more variables affect the predicted output of the model. Variable
importance values are proportional to the standardized coefficients of
the covariates (see Supplementary Material), but they have the advantage
that variables can be grouped; for instance, ZOI of an infrastructure
type at different radii or variables related to the same type of
disturbance (e.g. trails and tourist cabins) can be grouped for an
assessment of the importance of multiple variables altogether.</p>
<p>Variable importance is computed here by the function
<code><a href="../reference/variable_importance.html">oneimpact::variable_importance()</a></code> by dropping certain terms
in the model (parameter <code>type = "drop"</code>), recomputing the
validation score, and comparing it to the validation score of the full
model. The greater the difference in scores, the largest is the
importance set to a certain variable or set of variables. This can also
be done through permutation of the values of each variable or term
(parameter <code>type = "permutation"</code>), even though the result in
theoretically the same, up to a constant (see Supplementary
Material).</p>
<p>Variable importance can be visualized using the function
<code><a href="../reference/plot_importance.html">oneimpact::plot_importance()</a></code>.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># variable importance</span></span>
<span><span class="va">importance</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/variable_importance.html">variable_importance</a></span><span class="op">(</span><span class="va">bag_object</span>, </span>
<span>                                  data <span class="op">=</span> <span class="va">dat</span>, </span>
<span>                                  type <span class="op">=</span> <span class="st">"drop"</span>, <span class="co"># method = drop variable</span></span>
<span>                                  order <span class="op">=</span> <span class="st">"asc"</span><span class="op">)</span> <span class="co"># ascendent order</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in variable_importance(bag_object, data = dat, type = "drop", order =</span></span>
<span><span class="co">## "asc"): 477 missing observations were removed from the validate set. 73860</span></span>
<span><span class="co">## observations were kept.</span></span></code></pre>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#plot_importance(importance)</span></span>
<span><span class="fu"><a href="../reference/plot_importance.html">plot_importance</a></span><span class="op">(</span><span class="va">importance</span>, remove_threshold <span class="op">=</span> <span class="fl">5e-3</span><span class="op">)</span> <span class="co"># remove vars with too low score from plot</span></span></code></pre></div>
<p><img src="fitting_ZOI_logit_files/figure-html/variable_importance1-1.png" width="700"></p>
<p>Variable importance might also be computed for groups of variables.
For instance, below we group all variables with similar ZOI metric
(private cottages or public resorts) and all terms related to the same
variable (e.g. quadratic terms).</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Using variable block/type of variable</span></span>
<span><span class="va">variable_blocks</span> <span class="op">&lt;-</span> <span class="va">bag_object</span><span class="op">$</span><span class="va">var_names</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/strsplit.html" class="external-link">strsplit</a></span><span class="op">(</span>split <span class="op">=</span> <span class="st">"_cumulative_exp_decay|reclass|, 2)|, 2, raw = TRUE)|_sq"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"poly("</span>, replacement <span class="op">=</span> <span class="st">""</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">variable_blocks</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "private_cabins"         "private_cabins"         "private_cabins"        </span></span>
<span><span class="co">##  [4] "private_cabins"         "private_cabins"         "private_cabins"        </span></span>
<span><span class="co">##  [7] "private_cabins"         "private_cabins"         "public_cabins_high"    </span></span>
<span><span class="co">## [10] "public_cabins_high"     "public_cabins_high"     "public_cabins_high"    </span></span>
<span><span class="co">## [13] "public_cabins_high"     "public_cabins_high"     "public_cabins_high"    </span></span>
<span><span class="co">## [16] "public_cabins_high"     "NORUT"                  "NORUT"                 </span></span>
<span><span class="co">## [19] "NORUT"                  "NORUT"                  "NORUT"                 </span></span>
<span><span class="co">## [22] "NORUT"                  "NORUT"                  "NORUT"                 </span></span>
<span><span class="co">## [25] "NORUT"                  "NORUT"                  "NORUT"                 </span></span>
<span><span class="co">## [28] "NORUT"                  "NORUT"                  "NORUT"                 </span></span>
<span><span class="co">## [31] "norway_pca_klima_axis1" "norway_pca_klima_axis1" "norway_pca_klima_axis2"</span></span>
<span><span class="co">## [34] "norway_pca_klima_axis2" "norway_pca_klima_axis3" "norway_pca_klima_axis4"</span></span></code></pre>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">importance_block</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/variable_importance.html">variable_importance</a></span><span class="op">(</span><span class="va">bag_object</span>, </span>
<span>                                        data <span class="op">=</span> <span class="va">dat</span>, </span>
<span>                                        type <span class="op">=</span> <span class="st">"drop"</span>,</span>
<span>                                        order <span class="op">=</span> <span class="st">"asc"</span>,</span>
<span>                                        variable_block <span class="op">=</span> <span class="va">variable_blocks</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in variable_importance(bag_object, data = dat, type = "drop", order =</span></span>
<span><span class="co">## "asc", : 477 missing observations were removed from the validate set. 73860</span></span>
<span><span class="co">## observations were kept.</span></span></code></pre>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_importance.html">plot_importance</a></span><span class="op">(</span><span class="va">importance_block</span>, normalize <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre></div>
<p><img src="fitting_ZOI_logit_files/figure-html/variable_importance3-1.png" width="700"></p>
<p><strong>Add interpretation here</strong></p>
</div>
<div class="section level3">
<h3 id="model-coefficients">Model coefficients<a class="anchor" aria-label="anchor" href="#model-coefficients"></a>
</h3>
<p>The estimated coefficients from the models in the bag can be seen in
the <code>coef</code> element of the bag. It contains the coefficient of
each model/resample of the bag, for each term of the formula:</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># coefficients - already unstandardized by the fit_net_logit function</span></span>
<span><span class="va">bag_object</span><span class="op">$</span><span class="va">coef</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                                              Resample01   Resample02</span></span>
<span><span class="co">## private_cabins_cumulative_exp_decay100      0.000000000 -0.217722480</span></span>
<span><span class="co">## private_cabins_cumulative_exp_decay250      0.000000000  2.789575426</span></span>
<span><span class="co">## private_cabins_cumulative_exp_decay500      0.000000000 -0.813622269</span></span>
<span><span class="co">## private_cabins_cumulative_exp_decay1000     0.000000000 -2.018471424</span></span>
<span><span class="co">## private_cabins_cumulative_exp_decay2500     0.000000000  0.756565090</span></span>
<span><span class="co">## private_cabins_cumulative_exp_decay5000     0.000000000 -0.273827316</span></span>
<span><span class="co">## private_cabins_cumulative_exp_decay10000   -0.013470941  0.018423904</span></span>
<span><span class="co">## private_cabins_cumulative_exp_decay20000   -0.002503842 -0.005660242</span></span>
<span><span class="co">## public_cabins_high_cumulative_exp_decay100  0.000000000  0.000000000</span></span>
<span><span class="co">## public_cabins_high_cumulative_exp_decay250  0.000000000  0.000000000</span></span>
<span><span class="co">##                                              Resample03   Resample04</span></span>
<span><span class="co">## private_cabins_cumulative_exp_decay100      0.000000000  1.605574863</span></span>
<span><span class="co">## private_cabins_cumulative_exp_decay250      0.000000000  0.000000000</span></span>
<span><span class="co">## private_cabins_cumulative_exp_decay500      0.000000000 -0.956230606</span></span>
<span><span class="co">## private_cabins_cumulative_exp_decay1000     0.000000000 -0.630561170</span></span>
<span><span class="co">## private_cabins_cumulative_exp_decay2500     0.000000000  0.465549234</span></span>
<span><span class="co">## private_cabins_cumulative_exp_decay5000    -0.056312543 -0.174332629</span></span>
<span><span class="co">## private_cabins_cumulative_exp_decay10000   -0.013723062  0.010910344</span></span>
<span><span class="co">## private_cabins_cumulative_exp_decay20000   -0.002703108 -0.005957071</span></span>
<span><span class="co">## public_cabins_high_cumulative_exp_decay100  0.000000000  0.000000000</span></span>
<span><span class="co">## public_cabins_high_cumulative_exp_decay250  0.000000000  0.000000000</span></span>
<span><span class="co">##                                              Resample05</span></span>
<span><span class="co">## private_cabins_cumulative_exp_decay100      5.155970443</span></span>
<span><span class="co">## private_cabins_cumulative_exp_decay250     -4.466015986</span></span>
<span><span class="co">## private_cabins_cumulative_exp_decay500      0.000000000</span></span>
<span><span class="co">## private_cabins_cumulative_exp_decay1000    -1.064460163</span></span>
<span><span class="co">## private_cabins_cumulative_exp_decay2500     0.602427134</span></span>
<span><span class="co">## private_cabins_cumulative_exp_decay5000    -0.214032542</span></span>
<span><span class="co">## private_cabins_cumulative_exp_decay10000    0.016697510</span></span>
<span><span class="co">## private_cabins_cumulative_exp_decay20000   -0.006600537</span></span>
<span><span class="co">## public_cabins_high_cumulative_exp_decay100  0.000000000</span></span>
<span><span class="co">## public_cabins_high_cumulative_exp_decay250  0.000000000</span></span></code></pre>
<p>What is really going to be used for prediction, however, are the
weighted coefficients. To understand that, it is important to understand
that the model weights in the bag are defined based on the validation
scores, and they balance the contribution of the coefficients of each
model. Below we see the validation scores and weights. We see that all
models perform relatively well, which means all of them are given a
relative similar weight:</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># weights and weighted coefficients</span></span>
<span><span class="va">bag_object</span><span class="op">$</span><span class="va">validation_score</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] 0.9131054 0.9203894 0.9194246 0.9212400 0.9200966 0.9183340 0.9151591</span></span>
<span><span class="co">##  [8] 0.9181758 0.9194765 0.9190469</span></span></code></pre>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bag_object</span><span class="op">$</span><span class="va">weights</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">## Resample01 Resample02 Resample03 Resample04 Resample05 Resample06 Resample07 </span></span>
<span><span class="co">## 0.01973010 0.02004613 0.02000413 0.02008320 0.02003338 0.01995670 0.01981895 </span></span>
<span><span class="co">## Resample08 Resample09 Resample10 </span></span>
<span><span class="co">## 0.01994983 0.02000639 0.01998770</span></span></code></pre>
<p>Now we can get the weighted coefficients for each model, and averaged
over models.</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># weighted coefficients for each model</span></span>
<span><span class="va">bag_object</span><span class="op">$</span><span class="va">wcoef</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">##                                                 Resample01    Resample02</span></span>
<span><span class="co">## private_cabins_cumulative_exp_decay100        0.000000e+00 -0.0043644941</span></span>
<span><span class="co">## private_cabins_cumulative_exp_decay250        0.000000e+00  0.0559202039</span></span>
<span><span class="co">## private_cabins_cumulative_exp_decay500        0.000000e+00 -0.0163099814</span></span>
<span><span class="co">## private_cabins_cumulative_exp_decay1000       0.000000e+00 -0.0404625495</span></span>
<span><span class="co">## private_cabins_cumulative_exp_decay2500       0.000000e+00  0.0151662055</span></span>
<span><span class="co">## private_cabins_cumulative_exp_decay5000       0.000000e+00 -0.0054891792</span></span>
<span><span class="co">## private_cabins_cumulative_exp_decay10000     -2.657830e-04  0.0003693280</span></span>
<span><span class="co">## private_cabins_cumulative_exp_decay20000     -4.940106e-05 -0.0001134660</span></span>
<span><span class="co">## public_cabins_high_cumulative_exp_decay100    0.000000e+00  0.0000000000</span></span>
<span><span class="co">## public_cabins_high_cumulative_exp_decay250    0.000000e+00  0.0000000000</span></span>
<span><span class="co">## public_cabins_high_cumulative_exp_decay500    0.000000e+00 -9.3952783723</span></span>
<span><span class="co">## public_cabins_high_cumulative_exp_decay1000   0.000000e+00  2.3601156273</span></span>
<span><span class="co">## public_cabins_high_cumulative_exp_decay2500   0.000000e+00 -0.4818601011</span></span>
<span><span class="co">## public_cabins_high_cumulative_exp_decay5000   3.523046e-02  0.1126046723</span></span>
<span><span class="co">## public_cabins_high_cumulative_exp_decay10000  0.000000e+00  0.0842044565</span></span>
<span><span class="co">## public_cabins_high_cumulative_exp_decay20000 -5.205598e-02 -0.0922131303</span></span>
<span><span class="co">## NORUTreclass11forest                         -1.241574e-02 -0.0285041463</span></span>
<span><span class="co">## NORUTreclassbog                              -2.014264e-03  0.0029726925</span></span>
<span><span class="co">## NORUTreclass12                               -7.613544e-03 -0.0103235825</span></span>
<span><span class="co">## NORUTreclass13                                5.008703e-03  0.0046508807</span></span>
<span><span class="co">## NORUTreclass14                                2.422116e-03  0.0033569617</span></span>
<span><span class="co">## NORUTreclass15                                5.028864e-03 -0.0029298083</span></span>
<span><span class="co">## NORUTreclass16                                4.902450e-03  0.0036349092</span></span>
<span><span class="co">## NORUTreclass17                                1.788630e-03  0.0006578782</span></span>
<span><span class="co">## NORUTreclass18                                5.900950e-04  0.0021061214</span></span>
<span><span class="co">## NORUTreclass19                                0.000000e+00 -0.0024586418</span></span>
<span><span class="co">## NORUTreclass20                               -4.195502e-03 -0.0092122833</span></span>
<span><span class="co">## NORUTreclassglacier                          -1.696987e-02 -0.0256767528</span></span>
<span><span class="co">## NORUTreclasswater                            -3.444401e-02 -0.0506260406</span></span>
<span><span class="co">## NORUTreclassother                             0.000000e+00  0.0000000000</span></span>
<span><span class="co">## norway_pca_klima_axis1                        1.878606e-02  0.0253275529</span></span>
<span><span class="co">## norway_pca_klima_axis1_sq                    -1.185219e-02 -0.0126788069</span></span>
<span><span class="co">## norway_pca_klima_axis2                       -2.347891e-02 -0.0415971462</span></span>
<span><span class="co">## norway_pca_klima_axis2_sq                     0.000000e+00 -0.0041635599</span></span>
<span><span class="co">## norway_pca_klima_axis3                        0.000000e+00 -0.6751071263</span></span>
<span><span class="co">## norway_pca_klima_axis4                        0.000000e+00  0.8133562429</span></span></code></pre>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># weighted average coefficients</span></span>
<span><span class="va">bag_object</span><span class="op">$</span><span class="va">coef</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">bag_object</span><span class="op">$</span><span class="va">weights</span> <span class="co"># weighted average</span></span></code></pre></div>
<pre><code><span><span class="co">##                                                       [,1]</span></span>
<span><span class="co">## private_cabins_cumulative_exp_decay100        -0.456828583</span></span>
<span><span class="co">## private_cabins_cumulative_exp_decay250         0.452900863</span></span>
<span><span class="co">## private_cabins_cumulative_exp_decay500        -0.468653811</span></span>
<span><span class="co">## private_cabins_cumulative_exp_decay1000       -0.903680154</span></span>
<span><span class="co">## private_cabins_cumulative_exp_decay2500        0.473126528</span></span>
<span><span class="co">## private_cabins_cumulative_exp_decay5000       -0.179315177</span></span>
<span><span class="co">## private_cabins_cumulative_exp_decay10000       0.004527591</span></span>
<span><span class="co">## private_cabins_cumulative_exp_decay20000      -0.004597786</span></span>
<span><span class="co">## public_cabins_high_cumulative_exp_decay100   -96.025425007</span></span>
<span><span class="co">## public_cabins_high_cumulative_exp_decay250    -4.356691525</span></span>
<span><span class="co">## public_cabins_high_cumulative_exp_decay500   -54.322366936</span></span>
<span><span class="co">## public_cabins_high_cumulative_exp_decay1000   -5.649409456</span></span>
<span><span class="co">## public_cabins_high_cumulative_exp_decay2500   -5.272557691</span></span>
<span><span class="co">## public_cabins_high_cumulative_exp_decay5000   -1.875809624</span></span>
<span><span class="co">## public_cabins_high_cumulative_exp_decay10000   5.675197007</span></span>
<span><span class="co">## public_cabins_high_cumulative_exp_decay20000  -4.713887867</span></span>
<span><span class="co">## NORUTreclass11forest                          -0.741419115</span></span>
<span><span class="co">## NORUTreclassbog                                0.129552535</span></span>
<span><span class="co">## NORUTreclass12                                -0.407923738</span></span>
<span><span class="co">## NORUTreclass13                                 0.202352535</span></span>
<span><span class="co">## NORUTreclass14                                 0.304247970</span></span>
<span><span class="co">## NORUTreclass15                                 0.359671384</span></span>
<span><span class="co">## NORUTreclass16                                 0.210433837</span></span>
<span><span class="co">## NORUTreclass17                                 0.096818180</span></span>
<span><span class="co">## NORUTreclass18                                 0.182645472</span></span>
<span><span class="co">## NORUTreclass19                                -0.109029402</span></span>
<span><span class="co">## NORUTreclass20                                -0.248141537</span></span>
<span><span class="co">## NORUTreclassglacier                           -1.347011698</span></span>
<span><span class="co">## NORUTreclasswater                             -2.287984502</span></span>
<span><span class="co">## NORUTreclassother                              0.000000000</span></span>
<span><span class="co">## norway_pca_klima_axis1                         1.331876146</span></span>
<span><span class="co">## norway_pca_klima_axis1_sq                     -0.597549704</span></span>
<span><span class="co">## norway_pca_klima_axis2                        -3.462926625</span></span>
<span><span class="co">## norway_pca_klima_axis2_sq                     -0.543032968</span></span>
<span><span class="co">## norway_pca_klima_axis3                        57.828769971</span></span>
<span><span class="co">## norway_pca_klima_axis4                       -27.387982850</span></span></code></pre>
<p>Finally, we can plot the coefficients in each model in different ways
using the <code><a href="../reference/plot_coef.html">oneimpact::plot_coef()</a></code> function.</p>
<p><strong>explain one by one</strong></p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot weighted coefficients in each model, for all terms</span></span>
<span><span class="co"># plot_coef(bag_object)</span></span>
<span></span>
<span><span class="co"># different plots</span></span>
<span></span>
<span><span class="co"># only for private cabins, by resample, as bars</span></span>
<span><span class="co"># for all resamples</span></span>
<span><span class="co"># plot_coef(bag_object, terms = "private_cabins_cumulative")</span></span>
<span><span class="co"># for one the 3 first models</span></span>
<span><span class="fu"><a href="../reference/plot_coef.html">plot_coef</a></span><span class="op">(</span><span class="va">bag_object</span>, terms <span class="op">=</span> <span class="st">"private_cabins_cumulative"</span>, models <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p><img src="fitting_ZOI_logit_files/figure-html/coef5-1.png" width="700"></p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># only for private cabins, by resample, as points</span></span>
<span><span class="fu"><a href="../reference/plot_coef.html">plot_coef</a></span><span class="op">(</span><span class="va">bag_object</span>, terms <span class="op">=</span> <span class="st">"private_cabins_cumulative"</span>, </span>
<span>          plot_type <span class="op">=</span> <span class="st">"points"</span>, models <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p><img src="fitting_ZOI_logit_files/figure-html/coef5-2.png" width="700"></p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># only for private cabins, as histograms</span></span>
<span><span class="fu"><a href="../reference/plot_coef.html">plot_coef</a></span><span class="op">(</span><span class="va">bag_object</span>, terms <span class="op">=</span> <span class="st">"private_cabins_cumulative"</span>, </span>
<span>          plot_type <span class="op">=</span> <span class="st">"histogram"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</span></span></code></pre>
<p><img src="fitting_ZOI_logit_files/figure-html/coef5-3.png" width="700"></p>
<p>It is possible to see that several of the terms/covariates were
removed from the models in some of the resamples, i.e., their estimated
coefficients were zero. That is a property of Lasso and Adaptive Lasso
regression, that performs variable selection with model fitting.</p>
<p>We can also plot the raw or weighted average coefficients. This can
be done for all terms, or for terms of one specific type of variable. In
this case, for ZOI variables, it is advisable to order them according to
the ZOI radius with the option <code>order_zoi_radius = TRUE</code>.</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot weighted average coefs - all terms</span></span>
<span><span class="fu"><a href="../reference/plot_coef.html">plot_coef</a></span><span class="op">(</span><span class="va">bag_object</span>, what <span class="op">=</span> <span class="st">"average"</span><span class="op">)</span></span></code></pre></div>
<p><img src="fitting_ZOI_logit_files/figure-html/coef6-1.png" width="700"></p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot weighted average coefs - public cabins</span></span>
<span><span class="fu"><a href="../reference/plot_coef.html">plot_coef</a></span><span class="op">(</span><span class="va">bag_object</span>, what <span class="op">=</span> <span class="st">"average"</span>, terms <span class="op">=</span> <span class="st">"public_cabins"</span>, </span>
<span>          plot_type <span class="op">=</span> <span class="st">"points"</span>, order_zoi_radius <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="fitting_ZOI_logit_files/figure-html/coef6-2.png" width="700"></p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># zoom</span></span>
<span><span class="fu"><a href="../reference/plot_coef.html">plot_coef</a></span><span class="op">(</span><span class="va">bag_object</span>, what <span class="op">=</span> <span class="st">"average"</span>, terms <span class="op">=</span> <span class="st">"public_cabins"</span>, </span>
<span>          plot_type <span class="op">=</span> <span class="st">"points"</span>, order_zoi_radius <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="op">-</span><span class="fl">50</span>, <span class="fl">50</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: Removed 2 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">## (`geom_point()`).</span></span></code></pre>
<p><img src="fitting_ZOI_logit_files/figure-html/coef6-3.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="plot-the-effect-of-each-predictor-on-the-response-variable">Plot the effect of each predictor on the response variable<a class="anchor" aria-label="anchor" href="#plot-the-effect-of-each-predictor-on-the-response-variable"></a>
</h3>
<p>We can now plot the response variables one at a time with the
<code><a href="../reference/plot_response.html">oneimpact::plot_response</a></code> function. For that, we fix all
variables at their median values (or mean, or set them to zero; this is
controlled by the <code>baseline</code> parameter) and vary only one or
a few at a time.</p>
<div class="section level4">
<h4 id="pca1---continentality">PCA1 - continentality<a class="anchor" aria-label="anchor" href="#pca1---continentality"></a>
</h4>
<p>We start by plotting the effect of PCA 1, which is related to a
gradient of continentality. The red line below shows the average
weighted predicted value for the relative selection strength (in the y
axis), which is proportional to the probability of presence of the
species. The black line represents the weighted median predicted value,
and the grey stripe is the 75% weighted confidence interval, also called
the wighted interquartile range. Given the logistic structure of the
habitat selection model we ran, we make the prediction with the argument
<code>type = "logit"</code> to make a logit transformation before
predicting. In this scale, we should interpret values higher than 0.5 as
selection, and values lower than 0.5 as avoidance. However, the variable
responses are more easily interpreted as the gradient of change in
relative selection as the variable increases or decreases.</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot responses</span></span>
<span></span>
<span><span class="co"># PCA1</span></span>
<span><span class="va">wQ_probs</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span><span class="op">)</span> <span class="co"># percentiles for the median and confidence interval</span></span>
<span><span class="va">dfvar</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>norway_pca_klima_axis1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">bag_object</span><span class="op">$</span><span class="va">data_summary</span><span class="op">$</span><span class="va">norway_pca_klima_axis1</span><span class="op">)</span>,</span>
<span>                                                <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">bag_object</span><span class="op">$</span><span class="va">data_summary</span><span class="op">$</span><span class="va">norway_pca_klima_axis1</span><span class="op">)</span>,</span>
<span>                                                length.out <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">dfvar</span><span class="op">$</span><span class="va">norway_pca_klima_axis1_sq</span> <span class="op">=</span> <span class="va">dfvar</span><span class="op">$</span><span class="va">norway_pca_klima_axis1</span><span class="op">**</span><span class="fl">2</span></span>
<span></span>
<span><span class="co"># reference median</span></span>
<span><span class="fu"><a href="../reference/plot_response.html">plot_response</a></span><span class="op">(</span><span class="va">bag_object</span>, </span>
<span>              dfvar <span class="op">=</span> <span class="va">dfvar</span>, </span>
<span>              data <span class="op">=</span> <span class="va">dat</span>, </span>
<span>              type <span class="op">=</span> <span class="st">"exp"</span>, ci <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>              wq_probs <span class="op">=</span> <span class="va">wQ_probs</span><span class="op">)</span></span></code></pre></div>
<p><img src="fitting_ZOI_logit_files/figure-html/plot_response-1.png" width="700"></p>
<p>An alternative way to represent the variability in the model
predictions in the bag is also to plot the individual model predictions
as lines, instead of the weighted confidence interval. This is done
setting the parameters <code>individ_pred = TRUE</code> and
<code>ci = FALSE</code>.</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># reference median</span></span>
<span><span class="fu"><a href="../reference/plot_response.html">plot_response</a></span><span class="op">(</span><span class="va">bag_object</span>, </span>
<span>              dfvar <span class="op">=</span> <span class="va">dfvar</span>, data <span class="op">=</span> <span class="va">dat</span>, </span>
<span>              type <span class="op">=</span> <span class="st">"exp"</span>, </span>
<span>              indiv_pred <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>              ci <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="fitting_ZOI_logit_files/figure-html/plot_response1.2-1.png" width="700"></p>
</div>
<div class="section level4">
<h4 id="pca3---terrain-ruggedness">PCA3 - terrain ruggedness<a class="anchor" aria-label="anchor" href="#pca3---terrain-ruggedness"></a>
</h4>
<p>Now we plot the effect of PCA3, which is related to terrain
ruggedness.</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot responses</span></span>
<span></span>
<span><span class="co"># PCA3</span></span>
<span><span class="va">wQ_probs</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span><span class="op">)</span></span>
<span><span class="va">dfvar</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>norway_pca_klima_axis3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">bag_object</span><span class="op">$</span><span class="va">data_summary</span><span class="op">$</span><span class="va">norway_pca_klima_axis3</span><span class="op">)</span>,</span>
<span>                                                <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">bag_object</span><span class="op">$</span><span class="va">data_summary</span><span class="op">$</span><span class="va">norway_pca_klima_axis3</span><span class="op">)</span>,</span>
<span>                                                length.out <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot_response.html">plot_response</a></span><span class="op">(</span><span class="va">bag_object</span>, </span>
<span>              dfvar <span class="op">=</span> <span class="va">dfvar</span>, data <span class="op">=</span> <span class="va">dat</span>, </span>
<span>              type <span class="op">=</span> <span class="st">"exp"</span>, </span>
<span>              ci <span class="op">=</span> <span class="cn">FALSE</span>, indiv_pred <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="fitting_ZOI_logit_files/figure-html/plot_response2-1.png" width="700"></p>
</div>
<div class="section level4">
<h4 id="private-cabins">Private cabins<a class="anchor" aria-label="anchor" href="#private-cabins"></a>
</h4>
<p>Now we plot the effects of the ZOI of private cabins. Here the
<code><a href="../reference/plot_response.html">plot_response()</a></code> function gets all the variables that
contain “private_cabins” in the name. We plot the distance in
logarithmic scale to ease the visualization. We start by plotting the
relative selection strength considering the impact of one single private
cabin.</p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># ZOI private cabins</span></span>
<span><span class="va">dfvar</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>private_cabins <span class="op">=</span> <span class="fl">1e3</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">20</span>, length.out <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot_response.html">plot_response</a></span><span class="op">(</span><span class="va">bag_object</span>, </span>
<span>              dfvar <span class="op">=</span> <span class="va">dfvar</span>, data <span class="op">=</span> <span class="va">dat</span>, </span>
<span>              type <span class="op">=</span> <span class="st">"exp"</span>, zoi <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>              ci <span class="op">=</span> <span class="cn">FALSE</span>, indiv_pred <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>              logx <span class="op">=</span> <span class="cn">TRUE</span>, ylim <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="fitting_ZOI_logit_files/figure-html/plot_response3-1.png" width="700"></p>
<p>We see that the effects of a private cabin vary from strong effects
up to ca. 2.5km to very weak effect, depending on the model in the bag.
This means that there is a high variation on the effect size and ZOI of
one single private cabin, even though the weighted mean and median
effects are negative.</p>
<p>However, we see that both the realized effect size and the ZOI radius
increase as the density of cabins increase, and the negative effects
gets less uncertain. See below the response plot for a set of 10 and 100
cabins.</p>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 10 features</span></span>
<span><span class="fu"><a href="../reference/plot_response.html">plot_response</a></span><span class="op">(</span><span class="va">bag_object</span>, </span>
<span>              dfvar <span class="op">=</span> <span class="va">dfvar</span>, data <span class="op">=</span> <span class="va">dat</span>, </span>
<span>              n_features <span class="op">=</span> <span class="fl">10</span>,</span>
<span>              type <span class="op">=</span> <span class="st">"exp"</span>, zoi <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>              ci <span class="op">=</span> <span class="cn">FALSE</span>, indiv_pred <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>              logx <span class="op">=</span> <span class="cn">TRUE</span>, ylim <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="fitting_ZOI_logit_files/figure-html/plot_response4-1.png" width="700"></p>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 100 features</span></span>
<span><span class="fu"><a href="../reference/plot_response.html">plot_response</a></span><span class="op">(</span><span class="va">bag_object</span>, </span>
<span>              dfvar <span class="op">=</span> <span class="va">dfvar</span>, data <span class="op">=</span> <span class="va">dat</span>, </span>
<span>              type <span class="op">=</span> <span class="st">"exp"</span>, zoi <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>              n_features <span class="op">=</span> <span class="fl">100</span>,</span>
<span>              ci <span class="op">=</span> <span class="cn">FALSE</span>, indiv_pred <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>              logx <span class="op">=</span> <span class="cn">TRUE</span>, ylim <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="fitting_ZOI_logit_files/figure-html/plot_response4-2.png" width="700"></p>
</div>
<div class="section level4">
<h4 id="public-resorts">Public resorts<a class="anchor" aria-label="anchor" href="#public-resorts"></a>
</h4>
<p>Now we plot the response curves for public resorts. We start by
plotting the relative selection strength considering the impact of one
single resort.</p>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># ZOI public resorts cumulative</span></span>
<span><span class="va">dfvar</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>public_cabins <span class="op">=</span> <span class="fl">1e3</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">20</span>, length.out <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 1 feature</span></span>
<span><span class="fu"><a href="../reference/plot_response.html">plot_response</a></span><span class="op">(</span><span class="va">bag_object</span>, </span>
<span>              dfvar <span class="op">=</span> <span class="va">dfvar</span>, data <span class="op">=</span> <span class="va">dat</span>, </span>
<span>              type <span class="op">=</span> <span class="st">"exp"</span>, zoi <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>              n_features <span class="op">=</span> <span class="fl">1</span>,</span>
<span>              ci <span class="op">=</span> <span class="cn">FALSE</span>, indiv_pred <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>              logx <span class="op">=</span> <span class="cn">TRUE</span>, ylim <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: Removed 3 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">## (`geom_line()`).</span></span></code></pre>
<p><img src="fitting_ZOI_logit_files/figure-html/plot_response7-1.png" width="700"></p>
<p>We see a negative impact of a public resort, non-linearly, up to 20
km, with high variation in the range 100-2500 m, but with overall
average and median negative effects. We can also increase and evaluate
the impact of three public resorts in a neighborhood, the maximum
observed in the study area, which shows a more consistently negative
effect which only starts to decrease after 10 km.</p>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 3 features</span></span>
<span><span class="fu"><a href="../reference/plot_response.html">plot_response</a></span><span class="op">(</span><span class="va">bag_object</span>, </span>
<span>              dfvar <span class="op">=</span> <span class="va">dfvar</span>, data <span class="op">=</span> <span class="va">dat</span>, </span>
<span>              type <span class="op">=</span> <span class="st">"exp"</span>, zoi <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>              n_features <span class="op">=</span> <span class="fl">3</span>, </span>
<span>              ci <span class="op">=</span> <span class="cn">FALSE</span>, indiv_pred <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>              logx <span class="op">=</span> <span class="cn">TRUE</span>, ylim <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: Removed 3 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">## (`geom_line()`).</span></span></code></pre>
<p><img src="fitting_ZOI_logit_files/figure-html/plot_response8-1.png" width="700"></p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="spatial-predictions">Spatial predictions<a class="anchor" aria-label="anchor" href="#spatial-predictions"></a>
</h2>
<div class="section level3">
<h3 id="main-habitat-suitability-prediction-maps">Main habitat suitability prediction maps<a class="anchor" aria-label="anchor" href="#main-habitat-suitability-prediction-maps"></a>
</h3>
<p>Now we load the spatial data with the environmental covariates
included in the model above - land cover, the four bio-geo-climatic
PCAs, and the different ZOI variables for private and public cabins. The
data is loaded for the whole study area - the Hardangervidda wild
reindeer area in Norway and its surroundings.</p>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"raster/rast_predictors_hardanger_500m.tif"</span>, package <span class="op">=</span> <span class="st">"oneimpact"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "/home/runner/work/_temp/Library/oneimpact/raster/rast_predictors_hardanger_500m.tif"</span></span></code></pre>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rast_predictors</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span></span></code></pre></div>
<p>We can use the function <code><a href="../reference/bag_predict_spat.html">oneimpact::bag_predict_spat()</a></code> to
make spatial predictions based on the bag of fitted models. It is
possible to predict the weighted average suitability (if
<code>what = "mean"</code>), the weighted median suitability and
weighted percentiles of the suitability (if
<code>what = "median"</code>), to represent its uncertainty, and it is
also possible to create individual predictions for each model in the bag
(if <code>what = "ind"</code>). Below we compute the first two options
and start by plotting the weighted average habitat suitability, which
shows a similar pattern to the habitat suitability map presented in
Niebuhr et al. 2023 (Fig. 5f).</p>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bag_predict_spat.html">bag_predict_spat</a></span><span class="op">(</span>bag <span class="op">=</span> <span class="va">bag_object</span>, data <span class="op">=</span> <span class="va">rast_predictors</span>,</span>
<span>                         input_type <span class="op">=</span> <span class="st">"rast"</span>, what <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mean"</span>, <span class="st">"median"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># if rast_df was a data.frame</span></span>
<span><span class="co"># pred &lt;- bag_predict_spat(bag = bag_object, data = rast_df,</span></span>
<span><span class="co">#                          gid = "cell", coords = c("x", "y"), </span></span>
<span><span class="co">#                          crs = "epsg:25833")</span></span></code></pre></div>
<p>The function produces a list with:</p>
<ul>
<li>
<code>grid</code>, the data used for prediction (as a
<code>data.frame</code>);</li>
<li>
<code>weights</code>, the weights of each model in the bag;</li>
<li>three <code>SpatRaster</code> objects, possibly with multiple
layers, with the weighted average prediction, the weighted median
prediction (+ measures of uncertainty), and the individual model
predictions for the habitat suitability. Which elements are returned
depend on the values included in the <code>what</code> argument.</li>
</ul>
<p>Below we plot the first map, the weighted average prediction.</p>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># weighted average</span></span>
<span><span class="va">map1</span> <span class="op">&lt;-</span> <span class="fu">tmap</span><span class="fu">::</span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">pred</span><span class="op">[[</span><span class="st">"r_weighted_avg_pred"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">tmap</span><span class="fu">::</span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_raster.html" class="external-link">tm_raster</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Greens"</span>, style <span class="op">=</span> <span class="st">"cont"</span>, title <span class="op">=</span> <span class="st">"Suitability"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">tmap</span><span class="fu">::</span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_layout.html" class="external-link">tm_layout</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"LEFT"</span>, <span class="st">"BOTTOM"</span><span class="op">)</span>,</span>
<span>                  main.title <span class="op">=</span> <span class="st">"Weighted average habitat suitability"</span>,</span>
<span>                  main.title.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"center"</span><span class="op">)</span>,</span>
<span>                  main.title.size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># tmap::tm_shape(study_area_v) +</span></span>
<span>  <span class="co"># tmap::tm_borders() +</span></span>
<span>  <span class="fu">tmap</span><span class="fu">::</span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_compass.html" class="external-link">tm_compass</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">tmap v3 code detected</span> <span style="color: #00BBBB;">───────────────────────────────────────────────────────</span></span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">[v3-&gt;v4]</span> `tm_raster()`: instead of `style = "cont"`, use col.scale =</span></span>
<span><span class="co">## `tm_scale_continuous()`.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Migrate the argument(s) 'palette' (rename to 'values') to</span></span>
<span><span class="co">##   'tm_scale_continuous(&lt;HERE&gt;)'</span></span>
<span><span class="co">## <span style="color: #00BB00;">[v3-&gt;v4]</span> `tm_raster()`: migrate the argument(s) related to the legend of the</span></span>
<span><span class="co">## visual variable `col` namely 'title' to 'col.legend = tm_legend(&lt;HERE&gt;)'</span></span>
<span><span class="co">## <span style="color: #00BB00;">[v3-&gt;v4]</span> `tm_layout()`: use `tm_title()` instead of `tm_layout(main.title = )`</span></span></code></pre>
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">map1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #00BB00;">[cols4all]</span> color palettes: use palettes from the R package cols4all. Run</span></span>
<span><span class="co">## `cols4all::c4a_gui()` to explore them. The old palette name "Greens" is named</span></span>
<span><span class="co">## <span style="color: #0000BB;">"brewer.greens"</span></span></span></code></pre>
<p><img src="fitting_ZOI_logit_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<p>The weighted median suitability also produces a quite similar
prediction. It is by default stored in as the first layer of the raster
<code>pred$r_ind_summ_pred</code>.</p>
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># average/SD of individual pred</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">pred</span><span class="op">[[</span><span class="st">"r_ind_summ_pred"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Median"</span>, <span class="st">"IQR"</span>, <span class="st">"QCV"</span><span class="op">)</span></span>
<span><span class="va">map2</span> <span class="op">&lt;-</span> <span class="fu">tmap</span><span class="fu">::</span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">pred</span><span class="op">[[</span><span class="st">"r_ind_summ_pred"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">tmap</span><span class="fu">::</span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_raster.html" class="external-link">tm_raster</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Greens"</span>, style <span class="op">=</span> <span class="st">"cont"</span>, title <span class="op">=</span> <span class="st">"Suitability"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">tmap</span><span class="fu">::</span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_layout.html" class="external-link">tm_layout</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"LEFT"</span>, <span class="st">"BOTTOM"</span><span class="op">)</span>,</span>
<span>                  main.title <span class="op">=</span> <span class="st">"Weighted median habitat suitability"</span>,</span>
<span>                  main.title.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"center"</span><span class="op">)</span>,</span>
<span>                  main.title.size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># tmap::tm_shape(study_area_v) +</span></span>
<span>  <span class="co"># tmap::tm_borders() +</span></span>
<span>  <span class="fu">tmap</span><span class="fu">::</span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_compass.html" class="external-link">tm_compass</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">tmap v3 code detected</span> <span style="color: #00BBBB;">───────────────────────────────────────────────────────</span></span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">[v3-&gt;v4]</span> `tm_raster()`: instead of `style = "cont"`, use col.scale =</span></span>
<span><span class="co">## `tm_scale_continuous()`.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Migrate the argument(s) 'palette' (rename to 'values') to</span></span>
<span><span class="co">##   'tm_scale_continuous(&lt;HERE&gt;)'</span></span>
<span><span class="co">## <span style="color: #00BB00;">[v3-&gt;v4]</span> `tm_raster()`: migrate the argument(s) related to the legend of the</span></span>
<span><span class="co">## visual variable `col` namely 'title' to 'col.legend = tm_legend(&lt;HERE&gt;)'</span></span>
<span><span class="co">## <span style="color: #00BB00;">[v3-&gt;v4]</span> `tm_layout()`: use `tm_title()` instead of `tm_layout(main.title = )`</span></span></code></pre>
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">map2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #00BB00;">[cols4all]</span> color palettes: use palettes from the R package cols4all. Run</span></span>
<span><span class="co">## `cols4all::c4a_gui()` to explore them. The old palette name "Greens" is named</span></span>
<span><span class="co">## <span style="color: #0000BB;">"brewer.greens"</span></span></span></code></pre>
<p><img src="fitting_ZOI_logit_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<p>When the argument <code>what = "median"</code> is used in the
<code><a href="../reference/bag_predict_spat.html">bag_predict_spat()</a></code> function, it also allows us to compute
measures of uncertainty. The first measure (stored as the second layer
of the <code>pred$r_ind_summ_pred</code> raster object) is the range of
variation between the weighted percentile individual modeled
suitabilities. By default, it computes the interquartile range (IQR, the
different between the 25 and 75 weighted predicted percentiles), but
other values might be selected through the argument
<code>uncertainty_quantiles</code> in the
<code><a href="../reference/bag_predict_spat.html">bag_predict_spat()</a></code> function.</p>
<div class="sourceCode" id="cb86"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">map3</span> <span class="op">&lt;-</span> <span class="fu">tmap</span><span class="fu">::</span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">pred</span><span class="op">[[</span><span class="st">"r_ind_summ_pred"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">tmap</span><span class="fu">::</span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_raster.html" class="external-link">tm_raster</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Reds"</span>, style <span class="op">=</span> <span class="st">"cont"</span>, title <span class="op">=</span> <span class="st">"Uncertainty"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">tmap</span><span class="fu">::</span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_layout.html" class="external-link">tm_layout</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"LEFT"</span>, <span class="st">"BOTTOM"</span><span class="op">)</span>,</span>
<span>                  main.title <span class="op">=</span> <span class="st">"Interquartile range of the estimated suitability"</span>,</span>
<span>                  main.title.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"center"</span><span class="op">)</span>,</span>
<span>                  main.title.size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># tmap::tm_shape(study_area_v) +</span></span>
<span>  <span class="co"># tmap::tm_borders() +</span></span>
<span>  <span class="fu">tmap</span><span class="fu">::</span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_compass.html" class="external-link">tm_compass</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">tmap v3 code detected</span> <span style="color: #00BBBB;">───────────────────────────────────────────────────────</span></span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">[v3-&gt;v4]</span> `tm_raster()`: instead of `style = "cont"`, use col.scale =</span></span>
<span><span class="co">## `tm_scale_continuous()`.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Migrate the argument(s) 'palette' (rename to 'values') to</span></span>
<span><span class="co">##   'tm_scale_continuous(&lt;HERE&gt;)'</span></span>
<span><span class="co">## <span style="color: #00BB00;">[v3-&gt;v4]</span> `tm_raster()`: migrate the argument(s) related to the legend of the</span></span>
<span><span class="co">## visual variable `col` namely 'title' to 'col.legend = tm_legend(&lt;HERE&gt;)'</span></span>
<span><span class="co">## <span style="color: #00BB00;">[v3-&gt;v4]</span> `tm_layout()`: use `tm_title()` instead of `tm_layout(main.title = )`</span></span></code></pre>
<div class="sourceCode" id="cb90"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">map3</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #00BB00;">[cols4all]</span> color palettes: use palettes from the R package cols4all. Run</span></span>
<span><span class="co">## `cols4all::c4a_gui()` to explore them. The old palette name "Reds" is named</span></span>
<span><span class="co">## <span style="color: #0000BB;">"brewer.reds"</span></span></span></code></pre>
<p><img src="fitting_ZOI_logit_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<p>We see that the largest absolute variation between individual model
predictions is in the areas with high predicted average/median
suitability, which are the areas far away from all types of tourist
cabins.</p>
<p>The function also computes (by default) the quartile coefficient of
variation (QCV), which is defined as the ratio
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Q</mi><mi>C</mi><mi>V</mi><mo>=</mo><mfrac><mrow><msub><mi>p</mi><mn>75</mn></msub><mo>−</mo><msub><mi>p</mi><mn>25</mn></msub></mrow><mrow><msub><mi>p</mi><mn>75</mn></msub><mo>+</mo><msub><mi>p</mi><mn>25</mn></msub></mrow></mfrac></mrow><annotation encoding="application/x-tex">QCV = \frac{p_{75} - p_{25}}{p_{75} + p_{25}}</annotation></semantics></math>,
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>p</mi><mi>x</mi></msub><annotation encoding="application/x-tex">p_x</annotation></semantics></math>
is the <code>x%</code> percentile. We see now that this measures
highlights the relative (not the absolute) variation in the prediction,
which occurs close to the two types of cabins and in the areas of high
variation in the other predictors as well.</p>
<div class="sourceCode" id="cb92"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">map4</span> <span class="op">&lt;-</span> <span class="fu">tmap</span><span class="fu">::</span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">pred</span><span class="op">[[</span><span class="st">"r_ind_summ_pred"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">tmap</span><span class="fu">::</span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_raster.html" class="external-link">tm_raster</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Reds"</span>, style <span class="op">=</span> <span class="st">"cont"</span>, title <span class="op">=</span> <span class="st">"Uncertainty"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">tmap</span><span class="fu">::</span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_layout.html" class="external-link">tm_layout</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"LEFT"</span>, <span class="st">"BOTTOM"</span><span class="op">)</span>,</span>
<span>                  main.title <span class="op">=</span> <span class="st">"Quartile coefficient of variation of the estimated suitability"</span>,</span>
<span>                  main.title.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"center"</span><span class="op">)</span>,</span>
<span>                  main.title.size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># tmap::tm_shape(study_area_v) +</span></span>
<span>  <span class="co"># tmap::tm_borders() +</span></span>
<span>  <span class="fu">tmap</span><span class="fu">::</span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_compass.html" class="external-link">tm_compass</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">tmap v3 code detected</span> <span style="color: #00BBBB;">───────────────────────────────────────────────────────</span></span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">[v3-&gt;v4]</span> `tm_raster()`: instead of `style = "cont"`, use col.scale =</span></span>
<span><span class="co">## `tm_scale_continuous()`.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Migrate the argument(s) 'palette' (rename to 'values') to</span></span>
<span><span class="co">##   'tm_scale_continuous(&lt;HERE&gt;)'</span></span>
<span><span class="co">## <span style="color: #00BB00;">[v3-&gt;v4]</span> `tm_raster()`: migrate the argument(s) related to the legend of the</span></span>
<span><span class="co">## visual variable `col` namely 'title' to 'col.legend = tm_legend(&lt;HERE&gt;)'</span></span>
<span><span class="co">## <span style="color: #00BB00;">[v3-&gt;v4]</span> `tm_layout()`: use `tm_title()` instead of `tm_layout(main.title = )`</span></span></code></pre>
<div class="sourceCode" id="cb96"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">map4</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #00BB00;">[cols4all]</span> color palettes: use palettes from the R package cols4all. Run</span></span>
<span><span class="co">## `cols4all::c4a_gui()` to explore them. The old palette name "Reds" is named</span></span>
<span><span class="co">## <span style="color: #0000BB;">"brewer.reds"</span></span></span></code></pre>
<p><img src="fitting_ZOI_logit_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="predictor-impact-maps">Predictor impact maps<a class="anchor" aria-label="anchor" href="#predictor-impact-maps"></a>
</h3>
<p>We can also predict the impact of each individual covariate alone, by
multiplying the covariates by their respective estimated coefficients.
This can be done through the function
<code><a href="../reference/bag_predict_spat.html">oneimpact::bag_predict_spat_vars()</a></code>. Here, the
<code>predictor_table_zoi</code> computed above through the
<code><a href="../reference/add_zoi_formula.html">add_zoi_formula()</a></code> function can be used.</p>
<p>Similarly to the <code><a href="../reference/bag_predict_spat.html">bag_predict_spat()</a></code> function, the
<code><a href="../reference/bag_predict_spat.html">bag_predict_spat_vars()</a></code> function produces a list with:</p>
<ul>
<li>
<code>vars</code>, the names of the variables whose impact was
predicted (typically a pattern extracted from the predictor table, which
is similar for the same ZOI variables which change only on radii or for
variables with linear and quadratic terms, for instance);</li>
<li>
<code>grid</code>, a list of data.frames with the variables used for
the prediction of each variable response;</li>
<li>
<code>weights</code>, the weighted of each model in the bag;</li>
<li>three elements with the weighted average, median, and individual
predictions; each of them consists of a list of <code>SpatRaster</code>
objects, one for each variable list in <code>vars</code>.</li>
</ul>
<p>To make it fast, we produce only the mean weighted prediction for the
partial effect of each of the covariates.</p>
<div class="sourceCode" id="cb98"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># variables to be considered</span></span>
<span><span class="va">predictor_table_zoi</span><span class="op">$</span><span class="va">variable</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "private_cabins_"           "private_cabins_"          </span></span>
<span><span class="co">##  [3] "private_cabins_"           "private_cabins_"          </span></span>
<span><span class="co">##  [5] "private_cabins_"           "private_cabins_"          </span></span>
<span><span class="co">##  [7] "private_cabins_"           "private_cabins_"          </span></span>
<span><span class="co">##  [9] "public_cabins_high_"       "public_cabins_high_"      </span></span>
<span><span class="co">## [11] "public_cabins_high_"       "public_cabins_high_"      </span></span>
<span><span class="co">## [13] "public_cabins_high_"       "public_cabins_high_"      </span></span>
<span><span class="co">## [15] "public_cabins_high_"       "public_cabins_high_"      </span></span>
<span><span class="co">## [17] "NORUTreclass"              "norway_pca_klima_axis1"   </span></span>
<span><span class="co">## [19] "norway_pca_klima_axis1_sq" "norway_pca_klima_axis2"   </span></span>
<span><span class="co">## [21] "norway_pca_klima_axis2_sq" "norway_pca_klima_axis3"   </span></span>
<span><span class="co">## [23] "norway_pca_klima_axis4"</span></span></code></pre>
<div class="sourceCode" id="cb100"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># correct quadratic terms</span></span>
<span><span class="va">predictor_table_zoi</span><span class="op">$</span><span class="va">variable</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"poly("</span>, <span class="st">""</span>, <span class="va">predictor_table_zoi</span><span class="op">$</span><span class="va">variable</span>, fixed <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">", 2, raw = TRUE)|_sq"</span>, replacement <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pred_vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bag_predict_spat.html">bag_predict_spat_vars</a></span><span class="op">(</span>bag <span class="op">=</span> <span class="va">bag_object</span>, </span>
<span>                                   data <span class="op">=</span> <span class="va">rast_predictors</span>,</span>
<span>                                   predictor_table_zoi <span class="op">=</span> <span class="va">predictor_table_zoi</span>, </span>
<span>                                   prediction_type <span class="op">=</span> <span class="st">"exp"</span>,</span>
<span>                                   input_type <span class="op">=</span> <span class="st">"rast"</span>, what <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mean"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">pred_vars</span>, max.level <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## List of 6</span></span>
<span><span class="co">##  $ vars               :List of 7</span></span>
<span><span class="co">##   ..$ : chr "private_cabins_"</span></span>
<span><span class="co">##   ..$ : chr "public_cabins_high_"</span></span>
<span><span class="co">##   ..$ : chr "NORUTreclass"</span></span>
<span><span class="co">##   ..$ : chr "norway_pca_klima_axis1"</span></span>
<span><span class="co">##   ..$ : chr "norway_pca_klima_axis2"</span></span>
<span><span class="co">##   ..$ : chr "norway_pca_klima_axis3"</span></span>
<span><span class="co">##   ..$ : chr "norway_pca_klima_axis4"</span></span>
<span><span class="co">##  $ grid               :List of 7</span></span>
<span><span class="co">##   ..$ :'data.frame': 38204 obs. of  4 variables:</span></span>
<span><span class="co">##   ..$ :'data.frame': 38204 obs. of  4 variables:</span></span>
<span><span class="co">##   ..$ :'data.frame': 38204 obs. of  4 variables:</span></span>
<span><span class="co">##   ..$ :'data.frame': 38204 obs. of  4 variables:</span></span>
<span><span class="co">##   ..$ :'data.frame': 38204 obs. of  4 variables:</span></span>
<span><span class="co">##   ..$ :'data.frame': 38204 obs. of  4 variables:</span></span>
<span><span class="co">##   ..$ :'data.frame': 38204 obs. of  4 variables:</span></span>
<span><span class="co">##  $ weights            : Named num [1:50] 0.0197 0.02 0.02 0.0201 0.02 ...</span></span>
<span><span class="co">##   ..- attr(*, "names")= chr [1:50] "Resample01" "Resample02" "Resample03" "Resample04" ...</span></span>
<span><span class="co">##  $ r_weighted_avg_pred:List of 7</span></span>
<span><span class="co">##   ..$ :S4 class 'SpatRaster' [package "terra"]</span></span>
<span><span class="co">##   ..$ :S4 class 'SpatRaster' [package "terra"]</span></span>
<span><span class="co">##   ..$ :S4 class 'SpatRaster' [package "terra"]</span></span>
<span><span class="co">##   ..$ :S4 class 'SpatRaster' [package "terra"]</span></span>
<span><span class="co">##   ..$ :S4 class 'SpatRaster' [package "terra"]</span></span>
<span><span class="co">##   ..$ :S4 class 'SpatRaster' [package "terra"]</span></span>
<span><span class="co">##   ..$ :S4 class 'SpatRaster' [package "terra"]</span></span>
<span><span class="co">##  $ r_ind_summ_pred    : NULL</span></span>
<span><span class="co">##  $ r_ind_pred         : NULL</span></span></code></pre>
<p>We can start by plotting the expected impact of one of the
bio-geo-climatic PCAs (PCA3) and the land cover layer, as an example.
Here, we have plotted the responses in the exponential scale, for
simplicity. This means that values above 1 represent selection, and
values below 1 represent avoidance.</p>
<div class="sourceCode" id="cb102"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plots</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">4</span>,<span class="fl">6</span><span class="op">)</span>, </span>
<span>                <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="co">#plot(x, main = names(x), col = map.pal("viridis")))</span></span>
<span>                  <span class="fu">tmap</span><span class="fu">::</span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">pred_vars</span><span class="op">$</span><span class="va">r_weighted_avg_pred</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>              <span class="fu">tmap</span><span class="fu">::</span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_raster.html" class="external-link">tm_raster</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"PiYG"</span>, style <span class="op">=</span> <span class="st">"cont"</span>,</span>
<span>                              title <span class="op">=</span> <span class="st">"Effect"</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span>, <span class="fl">0.1</span><span class="op">)</span>,</span>
<span>                              midpoint <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>              <span class="fu">tmap</span><span class="fu">::</span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_layout.html" class="external-link">tm_layout</a></span><span class="op">(</span><span class="co">#legend.position = c("LEFT", "BOTTOM"),</span></span>
<span>                legend.outside <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                main.title <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">pred_vars</span><span class="op">$</span><span class="va">vars</span><span class="op">[</span><span class="va">x</span><span class="op">]</span><span class="op">)</span>,<span class="co">#"Weighted average effect of predictors",</span></span>
<span>                main.title.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"center"</span><span class="op">)</span>,</span>
<span>                main.title.size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>              <span class="fu">tmap</span><span class="fu">::</span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_compass.html" class="external-link">tm_compass</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">tmap v3 code detected</span> <span style="color: #00BBBB;">───────────────────────────────────────────────────────</span></span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">[v3-&gt;v4]</span> `tm_raster()`: instead of `style = "cont"`, use col.scale =</span></span>
<span><span class="co">## `tm_scale_continuous()`.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Migrate the argument(s) 'breaks' (rename to 'ticks'), 'midpoint', 'palette'</span></span>
<span><span class="co">##   (rename to 'values') to 'tm_scale_continuous(&lt;HERE&gt;)'</span></span>
<span><span class="co">## For small multiples, specify a 'tm_scale_' for each multiple, and put them in a</span></span>
<span><span class="co">## list: 'col'.scale = list(&lt;scale1&gt;, &lt;scale2&gt;, ...)'</span></span>
<span><span class="co">## <span style="color: #00BB00;">[v3-&gt;v4]</span> `tm_raster()`: migrate the argument(s) related to the legend of the</span></span>
<span><span class="co">## visual variable `col` namely 'title' to 'col.legend = tm_legend(&lt;HERE&gt;)'</span></span>
<span><span class="co">## <span style="color: #00BB00;">[v3-&gt;v4]</span> `tm_raster()`: migrate the argument(s) related to the legend of the</span></span>
<span><span class="co">## visual variable `col` namely 'title' to 'col.legend = tm_legend(&lt;HERE&gt;)'</span></span>
<span><span class="co">## <span style="color: #00BB00;">[v3-&gt;v4]</span> `tm_raster()`: migrate the argument(s) related to the legend of the</span></span>
<span><span class="co">## visual variable `col` namely 'title' to 'col.legend = tm_legend(&lt;HERE&gt;)'</span></span></code></pre>
<div class="sourceCode" id="cb106"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">plots</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [[1]]</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">[cols4all]</span> color palettes: use palettes from the R package cols4all. Run</span></span>
<span><span class="co">## `cols4all::c4a_gui()` to explore them. The old palette name "PiYG" is named</span></span>
<span><span class="co">## <span style="color: #0000BB;">"brewer.pi_yg"</span></span></span>
<span><span class="co">## <span style="color: #00BB00;">[plot mode]</span> fit legend/component: Some legend items or map compoments do not</span></span>
<span><span class="co">## fit well, and are therefore rescaled.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Set the tmap option `component.autoscale = FALSE` to disable rescaling.</span></span></code></pre>
<p><img src="fitting_ZOI_logit_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## [[2]]</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">[cols4all]</span> color palettes: use palettes from the R package cols4all. Run</span></span>
<span><span class="co">## `cols4all::c4a_gui()` to explore them. The old palette name "PiYG" is named</span></span>
<span><span class="co">## <span style="color: #0000BB;">"brewer.pi_yg"</span></span></span>
<span><span class="co">## <span style="color: #00BB00;">[plot mode]</span> fit legend/component: Some legend items or map compoments do not</span></span>
<span><span class="co">## fit well, and are therefore rescaled.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Set the tmap option `component.autoscale = FALSE` to disable rescaling.</span></span></code></pre>
<p><img src="fitting_ZOI_logit_files/figure-html/unnamed-chunk-9-2.png" width="700"></p>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## [[3]]</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">[cols4all]</span> color palettes: use palettes from the R package cols4all. Run</span></span>
<span><span class="co">## `cols4all::c4a_gui()` to explore them. The old palette name "PiYG" is named</span></span>
<span><span class="co">## <span style="color: #0000BB;">"brewer.pi_yg"</span></span></span>
<span><span class="co">## <span style="color: #00BB00;">[plot mode]</span> fit legend/component: Some legend items or map compoments do not</span></span>
<span><span class="co">## fit well, and are therefore rescaled.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Set the tmap option `component.autoscale = FALSE` to disable rescaling.</span></span></code></pre>
<p><img src="fitting_ZOI_logit_files/figure-html/unnamed-chunk-9-3.png" width="700"></p>
<p>We see in these images that the effect of PC1 (continentality) is the
largest between those variables, followed by that of land cover and
effect of PCA3 (terrain ruggedness). We also see that reindeer in summer
avoid the lower lands with forests and climates which are too oceanic
(in the West).</p>
<p>We can now plot the spatial impact of private cabins and public
cabins. As shown above, the effect of both types of infrastructure is
very strong.</p>
<div class="sourceCode" id="cb113"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># private cabins</span></span>
<span><span class="va">map_plot</span> <span class="op">&lt;-</span> <span class="va">pred_vars</span><span class="op">$</span><span class="va">r_weighted_avg_pred</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">map1</span> <span class="op">&lt;-</span> <span class="fu">tmap</span><span class="fu">::</span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">map_plot</span><span class="op">)</span> <span class="op">+</span></span>
<span>              <span class="fu">tmap</span><span class="fu">::</span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_raster.html" class="external-link">tm_raster</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"PiYG"</span>, style <span class="op">=</span> <span class="st">"cont"</span>,</span>
<span>                              title <span class="op">=</span> <span class="st">"Effect"</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span>, <span class="fl">0.1</span><span class="op">)</span>,</span>
<span>                              midpoint <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>              <span class="fu">tmap</span><span class="fu">::</span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_layout.html" class="external-link">tm_layout</a></span><span class="op">(</span><span class="co">#legend.position = c("LEFT", "BOTTOM"),</span></span>
<span>                legend.outside <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                main.title <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">map_plot</span><span class="op">)</span>,<span class="co">#"Weighted average effect of predictors",</span></span>
<span>                main.title.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"center"</span><span class="op">)</span>,</span>
<span>                main.title.size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>              <span class="fu">tmap</span><span class="fu">::</span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_compass.html" class="external-link">tm_compass</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">tmap v3 code detected</span> <span style="color: #00BBBB;">───────────────────────────────────────────────────────</span></span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">[v3-&gt;v4]</span> `tm_raster()`: instead of `style = "cont"`, use col.scale =</span></span>
<span><span class="co">## `tm_scale_continuous()`.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Migrate the argument(s) 'breaks' (rename to 'ticks'), 'midpoint', 'palette'</span></span>
<span><span class="co">##   (rename to 'values') to 'tm_scale_continuous(&lt;HERE&gt;)'</span></span>
<span><span class="co">## For small multiples, specify a 'tm_scale_' for each multiple, and put them in a</span></span>
<span><span class="co">## list: 'col'.scale = list(&lt;scale1&gt;, &lt;scale2&gt;, ...)'</span></span>
<span><span class="co">## <span style="color: #00BB00;">[v3-&gt;v4]</span> `tm_raster()`: migrate the argument(s) related to the legend of the</span></span>
<span><span class="co">## visual variable `col` namely 'title' to 'col.legend = tm_legend(&lt;HERE&gt;)'</span></span>
<span><span class="co">## <span style="color: #00BB00;">[v3-&gt;v4]</span> `tm_layout()`: use `tm_title()` instead of `tm_layout(main.title = )`</span></span></code></pre>
<div class="sourceCode" id="cb117"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">map1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #00BB00;">[cols4all]</span> color palettes: use palettes from the R package cols4all. Run</span></span>
<span><span class="co">## `cols4all::c4a_gui()` to explore them. The old palette name "PiYG" is named</span></span>
<span><span class="co">## <span style="color: #0000BB;">"brewer.pi_yg"</span></span></span>
<span><span class="co">## <span style="color: #00BB00;">[plot mode]</span> fit legend/component: Some legend items or map compoments do not</span></span>
<span><span class="co">## fit well, and are therefore rescaled.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Set the tmap option `component.autoscale = FALSE` to disable rescaling.</span></span></code></pre>
<p><img src="fitting_ZOI_logit_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<div class="sourceCode" id="cb119"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># public cabins</span></span>
<span><span class="va">map_plot</span> <span class="op">&lt;-</span> <span class="va">pred_vars</span><span class="op">$</span><span class="va">r_weighted_avg_pred</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">map2</span> <span class="op">&lt;-</span> <span class="fu">tmap</span><span class="fu">::</span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">map_plot</span><span class="op">)</span> <span class="op">+</span></span>
<span>              <span class="fu">tmap</span><span class="fu">::</span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_raster.html" class="external-link">tm_raster</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"PiYG"</span>, style <span class="op">=</span> <span class="st">"cont"</span>,</span>
<span>                              title <span class="op">=</span> <span class="st">"Effect"</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span>, <span class="fl">0.1</span><span class="op">)</span>,</span>
<span>                              midpoint <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>              <span class="fu">tmap</span><span class="fu">::</span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_layout.html" class="external-link">tm_layout</a></span><span class="op">(</span></span>
<span>                legend.outside <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                main.title <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">map_plot</span><span class="op">)</span>,<span class="co">#"Weighted average effect of predictors",</span></span>
<span>                main.title.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"center"</span><span class="op">)</span>,</span>
<span>                main.title.size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>              <span class="fu">tmap</span><span class="fu">::</span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_compass.html" class="external-link">tm_compass</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">tmap v3 code detected</span> <span style="color: #00BBBB;">───────────────────────────────────────────────────────</span></span></span>
<span><span class="co">## <span style="color: #00BB00;">[v3-&gt;v4]</span> `tm_raster()`: instead of `style = "cont"`, use col.scale =</span></span>
<span><span class="co">## `tm_scale_continuous()`.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Migrate the argument(s) 'breaks' (rename to 'ticks'), 'midpoint', 'palette'</span></span>
<span><span class="co">##   (rename to 'values') to 'tm_scale_continuous(&lt;HERE&gt;)'</span></span>
<span><span class="co">## For small multiples, specify a 'tm_scale_' for each multiple, and put them in a</span></span>
<span><span class="co">## list: 'col'.scale = list(&lt;scale1&gt;, &lt;scale2&gt;, ...)'<span style="color: #00BB00;">[v3-&gt;v4]</span> `tm_raster()`: migrate the argument(s) related to the legend of the</span></span>
<span><span class="co">## visual variable `col` namely 'title' to 'col.legend = tm_legend(&lt;HERE&gt;)'<span style="color: #00BB00;">[v3-&gt;v4]</span> `tm_layout()`: use `tm_title()` instead of `tm_layout(main.title = )`</span></span></code></pre>
<div class="sourceCode" id="cb121"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">map2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #00BB00;">[cols4all]</span> color palettes: use palettes from the R package cols4all. Run</span></span>
<span><span class="co">## `cols4all::c4a_gui()` to explore them. The old palette name "PiYG" is named</span></span>
<span><span class="co">## <span style="color: #0000BB;">"brewer.pi_yg"</span></span></span>
<span><span class="co">## <span style="color: #00BB00;">[plot mode]</span> fit legend/component: Some legend items or map compoments do not</span></span>
<span><span class="co">## fit well, and are therefore rescaled.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Set the tmap option `component.autoscale = FALSE` to disable rescaling.</span></span></code></pre>
<p><img src="fitting_ZOI_logit_files/figure-html/unnamed-chunk-10-2.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="concluding-remarks">Concluding remarks<a class="anchor" aria-label="anchor" href="#concluding-remarks"></a>
</h2>
<p><strong>Add something here</strong></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Bernardo Brandão Niebuhr, Manuela Panzacchi, Bram van Moorter.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
